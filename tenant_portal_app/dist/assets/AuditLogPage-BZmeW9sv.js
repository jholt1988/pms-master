import{r as l,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as x}from"./index-BHiZdJVs.js";import{a as m}from"./apiClient-DATCuIGb.js";import"./vendor-BVwjo9X5.js";import"./nextui-vendor-BpFfdwSS.js";import"./framer-motion-hFs7l1RU.js";import"./utils-vendor-9uJw-9S8.js";import"./lucide-icons-D0L7Z31B.js";const p=t=>{const a=new Date(t);return Number.isNaN(a.getTime())?t:a.toLocaleString()},h=({event:t})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.type}),t.metadata?e.jsxs("details",{className:"text-xs text-gray-500",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-semibold text-indigo-600",children:"View metadata"}),e.jsx("pre",{className:"mt-1 max-h-40 overflow-auto rounded bg-gray-50 p-2 text-[11px] leading-relaxed",children:JSON.stringify(t.metadata,null,2)})]}):null]});function v(){const{token:t}=x(),[a,n]=l.useState([]),[o,i]=l.useState(!0),[c,d]=l.useState(null);return l.useEffect(()=>{(async()=>{if(!t){i(!1);return}d(null);try{const r=await m("/security-events?limit=200",{token:t});n(r)}catch(r){d(r instanceof Error?r.message:"Failed to load audit events")}finally{i(!1)}})()},[t]),t?o?e.jsx("div",{className:"p-4",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Security audit trail"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monitor authentication activity, configuration changes, and other sensitive operations."})]}),c&&e.jsx("div",{className:"rounded-md border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:c}),e.jsxs("section",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Events captured"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:a.length})]}),e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Successful"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-emerald-600",children:a.filter(s=>s.success).length})]}),e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Failed"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-rose-600",children:a.filter(s=>!s.success).length})]})]}),e.jsx("section",{className:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs font-semibold uppercase tracking-wide text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Event"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Actor"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"IP address"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"User agent"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Result"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Timestamp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-sm text-gray-500",children:"No audit activity recorded yet."})}):[...a].sort((s,r)=>new Date(r.createdAt).getTime()-new Date(s.createdAt).getTime()).map(s=>e.jsxs("tr",{className:"align-top",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(h,{event:s})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.username??"System"}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.ipAddress??"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:e.jsx("span",{className:"line-clamp-3 wrap-break-word",children:s.userAgent??"—"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold ${s.success?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:s.success?"Success":"Failure"})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:p(s.createdAt)})]},s.id))})]})})})]}):e.jsx("div",{className:"p-4",children:"Please sign in as a property manager to view audit logs."})}export{v as default};
