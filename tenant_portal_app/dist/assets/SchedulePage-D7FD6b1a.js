import{r as c,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as G}from"./index-BHiZdJVs.js";import{g as V,a as T}from"./apiClient-DATCuIGb.js";import{P as W,l as $,m as F,n as K,o as X,k as B,U as q,p as Y}from"./lucide-icons-D0L7Z31B.js";import{b as d,c as o,a as x,s as y,l as a,e as g,m as J,f as Q,g as Z,h as ee,i as u,t as te,j as se}from"./nextui-vendor-BpFfdwSS.js";import"./vendor-BVwjo9X5.js";import"./utils-vendor-9uJw-9S8.js";import"./framer-motion-hFs7l1RU.js";const me=()=>{const{token:N}=G(),[_,A]=c.useState([]),[m,S]=c.useState(null),[w,U]=c.useState(!0),[i,E]=c.useState("weekly"),[h,M]=c.useState(new Date),[v,D]=c.useState("all"),[f,L]=c.useState("all"),[R,j]=c.useState(!1),[s,n]=c.useState({type:"TOUR",title:"",date:"",time:"",priority:"MEDIUM",description:"",propertyId:"",unitId:"",tenantId:""}),p=V(),O=async()=>{try{const t=h.toISOString().split("T")[0],r=i==="daily"?`${p}/schedule/daily?date=${t}`:i==="weekly"?`${p}/schedule/weekly?startDate=${t}`:`${p}/schedule/monthly?month=${h.getMonth()+1}&year=${h.getFullYear()}`,l=await T(r,{token:N});A(l)}catch(t){console.error("Error fetching events:",t)}finally{U(!1)}},b=async()=>{try{const t=await T(`${p}/schedule/summary`,{token:N});S(t)}catch(t){console.error("Error fetching summary:",t)}},P=async()=>{try{await T(`${p}/schedule`,{method:"POST",token:N,body:{type:s.type,title:s.title,date:new Date(s.date+"T"+(s.time||"00:00")),priority:s.priority,description:s.description,propertyId:s.propertyId?parseInt(s.propertyId):void 0,unitId:s.unitId?parseInt(s.unitId):void 0,tenantId:s.tenantId?parseInt(s.tenantId):void 0}}),j(!1),n({type:"TOUR",title:"",date:"",time:"",priority:"MEDIUM",description:"",propertyId:"",unitId:"",tenantId:""}),O(),b()}catch(t){console.error("Error creating event:",t)}};c.useEffect(()=>{O(),b()},[i,h]);const I=t=>{const r=new Date(h);if(t==="today"){M(new Date);return}i==="daily"?r.setDate(r.getDate()+(t==="next"?1:-1)):i==="weekly"?r.setDate(r.getDate()+(t==="next"?7:-7)):r.setMonth(r.getMonth()+(t==="next"?1:-1)),M(r)},k=t=>({TOUR:"primary",MOVE_IN:"success",MOVE_OUT:"warning",LEASE_EXPIRATION:"danger",LEASE_RENEWAL:"secondary",INSPECTION:"default",MAINTENANCE:"default"})[t],z=t=>({LOW:"success",MEDIUM:"warning",HIGH:"warning",URGENT:"danger"})[t],H=_.filter(t=>!(v!=="all"&&t.type!==v||f!=="all"&&t.priority!==f)),C=(()=>{const t={};return H.forEach(r=>{const l=new Date(r.date).toLocaleDateString();t[l]||(t[l]=[]),t[l].push(r)}),t})();return w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("p",{className:"text-gray-500",children:"Loading schedule..."})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Schedule"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage tours, inspections, and property events"})]}),e.jsx(d,{color:"primary",startContent:e.jsx(W,{size:20}),onClick:()=>j(!0),children:"Add Event"})]}),m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(o,{children:e.jsxs(x,{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:m.totalEvents}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Events"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-success",children:m.upcomingTours}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upcoming Tours"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-danger",children:m.urgentCount}),e.jsx("p",{className:"text-sm text-gray-600",children:"Urgent"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-warning",children:m.highPriorityCount}),e.jsx("p",{className:"text-sm text-gray-600",children:"High Priority"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-default-500",children:m.mediumPriorityCount}),e.jsx("p",{className:"text-sm text-gray-600",children:"Medium Priority"})]})})]}),e.jsx(o,{className:"mb-6",children:e.jsx(x,{children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",color:i==="daily"?"primary":"default",variant:i==="daily"?"solid":"bordered",onClick:()=>E("daily"),children:"Daily"}),e.jsx(d,{size:"sm",color:i==="weekly"?"primary":"default",variant:i==="weekly"?"solid":"bordered",onClick:()=>E("weekly"),children:"Weekly"}),e.jsx(d,{size:"sm",color:i==="monthly"?"primary":"default",variant:i==="monthly"?"solid":"bordered",onClick:()=>E("monthly"),children:"Monthly"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"sm",isIconOnly:!0,variant:"bordered",onClick:()=>I("prev"),children:e.jsx($,{size:20})}),e.jsx("span",{className:"text-sm font-medium px-3",children:h.toLocaleDateString("en-US",{month:"long",day:i!=="monthly"?"numeric":void 0,year:"numeric"})}),e.jsx(d,{size:"sm",isIconOnly:!0,variant:"bordered",onClick:()=>I("next"),children:e.jsx(F,{size:20})}),e.jsx(d,{size:"sm",variant:"flat",onClick:()=>I("today"),children:"Today"})]}),e.jsxs(y,{size:"sm",label:"Event Type",className:"max-w-xs",selectedKeys:[v],onChange:t=>D(t.target.value),children:[e.jsx(a,{value:"all",children:"All Types"},"all"),e.jsx(a,{value:"TOUR",children:"Tours"},"TOUR"),e.jsx(a,{value:"MOVE_IN",children:"Move-ins"},"MOVE_IN"),e.jsx(a,{value:"MOVE_OUT",children:"Move-outs"},"MOVE_OUT"),e.jsx(a,{value:"LEASE_EXPIRATION",children:"Lease Expirations"},"LEASE_EXPIRATION"),e.jsx(a,{value:"LEASE_RENEWAL",children:"Lease Renewals"},"LEASE_RENEWAL"),e.jsx(a,{value:"INSPECTION",children:"Inspections"},"INSPECTION"),e.jsx(a,{value:"MAINTENANCE",children:"Maintenance"},"MAINTENANCE")]}),e.jsxs(y,{size:"sm",label:"Priority",className:"max-w-xs",selectedKeys:[f],onChange:t=>L(t.target.value),children:[e.jsx(a,{value:"all",children:"All Priorities"},"all"),e.jsx(a,{value:"URGENT",children:"Urgent"},"URGENT"),e.jsx(a,{value:"HIGH",children:"High"},"HIGH"),e.jsx(a,{value:"MEDIUM",children:"Medium"},"MEDIUM"),e.jsx(a,{value:"LOW",children:"Low"},"LOW")]})]})})}),e.jsx("div",{className:"space-y-6",children:Object.keys(C).length===0?e.jsx(o,{children:e.jsxs(x,{className:"text-center py-12",children:[e.jsx(K,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No events scheduled for this period"})]})}):Object.entries(C).map(([t,r])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),e.jsx(g,{size:"sm",color:"primary",children:r.length})]}),e.jsx("div",{className:"space-y-3",children:r.map(l=>e.jsx(o,{children:e.jsx(x,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(g,{color:k(l.type),variant:"flat",size:"sm",children:l.type.replace(/_/g," ")}),e.jsx(g,{color:z(l.priority),variant:"dot",size:"sm",children:l.priority}),l.status&&e.jsx(g,{size:"sm",variant:"bordered",children:l.status})]}),e.jsx("h4",{className:"font-semibold text-lg mb-2",children:l.title}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600",children:[l.time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{size:14}),e.jsx("span",{children:l.time})]}),l.propertyName&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{size:14}),e.jsx("span",{children:l.propertyName})]}),l.unitName&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Unit: ",l.unitName]})}),l.tenantName&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{size:14}),e.jsx("span",{children:l.tenantName})]})]})]}),l.priority==="URGENT"&&e.jsx("div",{className:"flex items-center gap-2 text-danger",children:e.jsx(Y,{size:20})})]})})},l.id))})]},t))}),e.jsx(J,{isOpen:R,onClose:()=>j(!1),size:"2xl",children:e.jsxs(Q,{children:[e.jsx(Z,{children:"Add New Event"}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(y,{label:"Event Type",selectedKeys:[s.type],onChange:t=>n({...s,type:t.target.value}),children:[e.jsx(a,{value:"TOUR",children:"Tour"},"TOUR"),e.jsx(a,{value:"MOVE_IN",children:"Move In"},"MOVE_IN"),e.jsx(a,{value:"MOVE_OUT",children:"Move Out"},"MOVE_OUT"),e.jsx(a,{value:"LEASE_EXPIRATION",children:"Lease Expiration"},"LEASE_EXPIRATION"),e.jsx(a,{value:"LEASE_RENEWAL",children:"Lease Renewal"},"LEASE_RENEWAL"),e.jsx(a,{value:"INSPECTION",children:"Inspection"},"INSPECTION"),e.jsx(a,{value:"MAINTENANCE",children:"Maintenance"},"MAINTENANCE")]}),e.jsxs(y,{label:"Priority",selectedKeys:[s.priority],onChange:t=>n({...s,priority:t.target.value}),children:[e.jsx(a,{value:"LOW",children:"Low"},"LOW"),e.jsx(a,{value:"MEDIUM",children:"Medium"},"MEDIUM"),e.jsx(a,{value:"HIGH",children:"High"},"HIGH"),e.jsx(a,{value:"URGENT",children:"Urgent"},"URGENT")]})]}),e.jsx(u,{label:"Title",placeholder:"e.g., Property Tour - 123 Main St",value:s.title,onChange:t=>n({...s,title:t.target.value}),isRequired:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"Date",type:"date",value:s.date,onChange:t=>n({...s,date:t.target.value}),isRequired:!0}),e.jsx(u,{label:"Time",type:"time",value:s.time,onChange:t=>n({...s,time:t.target.value})})]}),e.jsx(te,{label:"Description",placeholder:"Add event details...",value:s.description,onChange:t=>n({...s,description:t.target.value}),minRows:3}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(u,{label:"Property ID (optional)",type:"number",placeholder:"1",value:s.propertyId,onChange:t=>n({...s,propertyId:t.target.value})}),e.jsx(u,{label:"Unit ID (optional)",type:"number",placeholder:"1",value:s.unitId,onChange:t=>n({...s,unitId:t.target.value})}),e.jsx(u,{label:"Tenant ID (optional)",type:"number",placeholder:"1",value:s.tenantId,onChange:t=>n({...s,tenantId:t.target.value})})]})]})}),e.jsxs(se,{children:[e.jsx(d,{variant:"light",onClick:()=>j(!1),children:"Cancel"}),e.jsx(d,{color:"primary",onClick:P,isDisabled:!s.title||!s.date,children:"Create Event"})]})]})})]})};export{me as default};
