import{r,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as D}from"./index-BHiZdJVs.js";import{a as m}from"./apiClient-DATCuIGb.js";import"./vendor-BVwjo9X5.js";import"./nextui-vendor-BpFfdwSS.js";import"./framer-motion-hFs7l1RU.js";import"./utils-vendor-9uJw-9S8.js";import"./lucide-icons-D0L7Z31B.js";function z(){const{token:o}=D(),[w,v]=r.useState([]),[T,p]=r.useState(!0),[y,d]=r.useState(null),[E,h]=r.useState(!1),[S,b]=r.useState(!1),[u,g]=r.useState(null),[f,C]=r.useState(""),[i,k]=r.useState(""),[n,j]=r.useState(0),[N,A]=r.useState(0),c=10,[t,l]=r.useState({username:"",password:"",role:"TENANT"});r.useEffect(()=>{x()},[n,i]);const x=async()=>{if(!o){p(!1);return}p(!0),d(null);try{const s=new URLSearchParams({skip:n.toString(),take:c.toString(),...i&&{role:i}}),a=await m(`/users?${s}`,{token:o});v(a.data),A(a.total)}catch(s){d(s.message||"Failed to load users")}finally{p(!1)}},U=async s=>{if(s.preventDefault(),!!o){d(null);try{await m("/users",{token:o,method:"POST",body:t}),h(!1),l({username:"",password:"",role:"TENANT"}),x()}catch(a){d(a.message||"Failed to create user")}}},P=async s=>{if(s.preventDefault(),!(!u||!o)){d(null);try{const a={};t.password&&(a.password=t.password),t.role!==u.role&&(a.role=t.role),await m(`/users/${u.id}`,{token:o,method:"PUT",body:a}),b(!1),g(null),l({username:"",password:"",role:"TENANT"}),x()}catch(a){d(a.message||"Failed to update user")}}},R=async s=>{if(o&&window.confirm("Are you sure you want to delete this user?"))try{await m(`/users/${s}`,{token:o,method:"DELETE"}),x()}catch(a){d(a.message||"Failed to delete user")}},M=s=>{g(s),l({username:s.username,password:"",role:s.role}),b(!0)},L=w.filter(s=>s.username.toLowerCase().includes(f.toLowerCase())&&(!i||s.role===i));return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"User Management"}),e.jsx("button",{onClick:()=>{l({username:"",password:"",role:"TENANT"}),h(!0)},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Create User"})]}),e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:f,onChange:s=>C(s.target.value),className:"flex-1 border rounded px-4 py-2"}),e.jsxs("select",{value:i,onChange:s=>{k(s.target.value),j(0)},className:"border rounded px-4 py-2",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"TENANT",children:"Tenant"}),e.jsx("option",{value:"PROPERTY_MANAGER",children:"Property Manager"})]})]}),y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:y}),T?e.jsx("div",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"ID"}),e.jsx("th",{className:"border px-4 py-2",children:"Username"}),e.jsx("th",{className:"border px-4 py-2",children:"Role"}),e.jsx("th",{className:"border px-4 py-2",children:"Last Login"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:L.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:s.id}),e.jsx("td",{className:"border px-4 py-2",children:s.username}),e.jsx("td",{className:"border px-4 py-2",children:s.role}),e.jsx("td",{className:"border px-4 py-2",children:s.lastLoginAt?new Date(s.lastLoginAt).toLocaleDateString():"Never"}),e.jsxs("td",{className:"border px-4 py-2",children:[e.jsx("button",{onClick:()=>M(s),className:"bg-blue-500 hover:bg-blue-700 text-white px-2 py-1 rounded mr-2",children:"Edit"}),e.jsx("button",{onClick:()=>R(s.id),className:"bg-red-500 hover:bg-red-700 text-white px-2 py-1 rounded",children:"Delete"})]})]},s.id))})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>j(Math.max(0,n-c)),disabled:n===0,className:"bg-gray-500 hover:bg-gray-700 text-white px-4 py-2 rounded disabled:opacity-50",children:"Previous"}),e.jsxs("span",{children:["Showing ",n+1," to ",Math.min(n+c,N)," of ",N]}),e.jsx("button",{onClick:()=>j(n+c),disabled:n+c>=N,className:"bg-gray-500 hover:bg-gray-700 text-white px-4 py-2 rounded disabled:opacity-50",children:"Next"})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Create User"}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Username"}),e.jsx("input",{type:"text",value:t.username,onChange:s=>l({...t,username:s.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Password"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>l({...t,password:s.target.value}),className:"w-full border rounded px-3 py-2",required:!0,minLength:8})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Role"}),e.jsxs("select",{value:t.role,onChange:s=>l({...t,role:s.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"TENANT",children:"Tenant"}),e.jsx("option",{value:"PROPERTY_MANAGER",children:"Property Manager"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded flex-1",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"bg-gray-500 hover:bg-gray-700 text-white px-4 py-2 rounded flex-1",children:"Cancel"})]})]})]})}),S&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Edit User"}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Username"}),e.jsx("input",{type:"text",value:t.username,disabled:!0,className:"w-full border rounded px-3 py-2 bg-gray-100"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"New Password (leave blank to keep current)"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>l({...t,password:s.target.value}),className:"w-full border rounded px-3 py-2",minLength:8})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Role"}),e.jsxs("select",{value:t.role,onChange:s=>l({...t,role:s.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"TENANT",children:"Tenant"}),e.jsx("option",{value:"PROPERTY_MANAGER",children:"Property Manager"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded flex-1",children:"Update"}),e.jsx("button",{type:"button",onClick:()=>{b(!1),g(null)},className:"bg-gray-500 hover:bg-gray-700 text-white px-4 py-2 rounded flex-1",children:"Cancel"})]})]})]})})]})}export{z as default};
