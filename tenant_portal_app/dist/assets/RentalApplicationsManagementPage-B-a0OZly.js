import{r as l,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as U}from"./index-BHiZdJVs.js";import{a as g}from"./apiClient-DATCuIGb.js";import"./vendor-BVwjo9X5.js";import"./nextui-vendor-BpFfdwSS.js";import"./framer-motion-hFs7l1RU.js";import"./utils-vendor-9uJw-9S8.js";import"./lucide-icons-D0L7Z31B.js";const q=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),E=d=>d==null?"—":q.format(d),M=d=>d==null?"—":d.toLocaleString(),y=d=>{if(!d)return"—";const c=new Date(d);return Number.isNaN(c.getTime())?"—":c.toLocaleString()},A=[{value:"PENDING",label:"Pending review"},{value:"APPROVED",label:"Approved"},{value:"REJECTED",label:"Rejected"}],F={PENDING:"bg-amber-100 text-amber-700",APPROVED:"bg-emerald-100 text-emerald-700",REJECTED:"bg-rose-100 text-rose-700"},Q={QUALIFIED:"Qualified",NOT_QUALIFIED:"Not qualified"},_={RECOMMEND_RENT:"Recommend",DO_NOT_RECOMMEND_RENT:"Do not recommend"},K=()=>{const[d,c]=l.useState([]),[D,b]=l.useState(!0),[f,o]=l.useState(null),[R,C]=l.useState(null),[x,j]=l.useState({}),[N,p]=l.useState(null),[I,v]=l.useState(null),[w,S]=l.useState(null),{token:i}=U();l.useEffect(()=>{(async()=>{if(!i){b(!1);return}try{const r=await g("/rental-applications",{token:i});c(r)}catch(r){o(r.message)}finally{b(!1)}})()},[i]);const P=async(s,r)=>{if(i){o(null);try{v(s),await g(`/rental-applications/${s}/status`,{token:i,method:"PUT",body:{status:r}}),c(n=>n.map(a=>a.id===s?{...a,status:r}:a))}catch(n){o(n.message)}finally{v(null)}}},T=async s=>{if(i){o(null);try{S(s);const r=await g(`/rental-applications/${s}/screen`,{token:i,method:"POST"});k(r)}catch(r){o(r.message)}finally{S(null)}}},O=async s=>{if(!(!i||!x[s]||!x[s].trim()))try{p(s),o(null);const r=await g(`/rental-applications/${s}/notes`,{token:i,method:"POST",body:{body:x[s]}});c(n=>n.map(a=>a.id===s?{...a,manualNotes:[r,...a.manualNotes??[]]}:a)),j(n=>({...n,[s]:""}))}catch(r){o(r.message)}finally{p(null)}},k=s=>{c(r=>r.map(n=>n.id===s.id?s:n))},L=s=>{C(r=>r===s?null:s)},m=l.useMemo(()=>{const s=d.filter(t=>t.status==="PENDING").length,r=d.filter(t=>t.status==="APPROVED").length,n=d.filter(t=>t.status==="REJECTED").length,a=d.filter(t=>!!t.screenedAt).length,u=d.filter(t=>t.qualificationStatus==="QUALIFIED").length;return{total:d.length,pending:s,approved:r,rejected:n,screened:a,qualified:u}},[d]);return D?e.jsx("div",{className:"p-4 text-sm text-gray-600",children:"Loading rental applications…"}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Rental applications"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Compare applicant profiles, run screening, and document decisions for every unit."})]}),f&&e.jsx("div",{className:"rounded-md border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:f}),e.jsxs("section",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Applications received"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900",children:m.total})]}),e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pending review"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-amber-600",children:m.pending})]}),e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Screened"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-indigo-600",children:m.screened})]}),e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Approved"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-emerald-600",children:m.approved})]}),e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Rejected"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-rose-600",children:m.rejected})]}),e.jsxs("article",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Qualified"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-sky-600",children:m.qualified})]})]}),e.jsx("section",{className:"space-y-4",children:d.length===0?e.jsx("div",{className:"rounded-lg border border-dashed border-gray-300 bg-white py-12 text-center text-sm text-gray-500",children:"No applications submitted yet."}):d.map(s=>{const r=R===s.id,n=x[s.id]??"",a=Array.isArray(s.screeningReasons)?s.screeningReasons:[],u=F[s.status]??"bg-gray-100 text-gray-600";return e.jsxs("article",{className:"space-y-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.fullName}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Applied ",y(s.createdAt)]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[s.email," · ",s.phoneNumber??"No phone"]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[s.property?.name??"Unknown property"," ·"," ",s.unit?.name??"Unit pending"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 text-sm",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold ${u}`,children:A.find(t=>t.value===s.status)?.label??s.status}),s.qualificationStatus&&e.jsx("span",{className:"rounded-full bg-sky-100 px-2.5 py-0.5 text-xs font-semibold text-sky-700",children:Q[s.qualificationStatus]??s.qualificationStatus}),e.jsx("button",{type:"button",onClick:()=>L(s.id),className:"text-xs font-semibold text-indigo-600 hover:text-indigo-500",children:r?"Hide details":"View details"})]})]}),e.jsxs("div",{className:"grid gap-3 text-xs text-gray-600 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Monthly income"}),e.jsx("p",{children:E(s.income)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Employment status"}),e.jsx("p",{children:s.employmentStatus??"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Credit score"}),e.jsx("p",{children:M(s.creditScore)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 border-t border-gray-100 pt-3 text-xs text-gray-600",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Status"}),e.jsx("select",{value:s.status,onChange:t=>P(s.id,t.target.value),disabled:I===s.id,className:"rounded-md border border-gray-300 px-2 py-1 text-xs focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 disabled:cursor-not-allowed disabled:bg-gray-100",children:A.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx("button",{type:"button",onClick:()=>T(s.id),disabled:w===s.id,className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1 text-xs font-semibold text-gray-700 shadow-sm hover:bg-gray-50 disabled:cursor-not-allowed disabled:bg-gray-100",children:w===s.id?"Screening…":s.screenedAt?"Re-run screening":"Run screening"})]}),r&&e.jsxs("div",{className:"space-y-4 border-t border-gray-100 pt-4 text-sm text-gray-700",children:[e.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Applicant profile"}),e.jsxs("dl",{className:"mt-3 space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Previous address"}),e.jsx("dd",{children:s.previousAddress??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Monthly debt"}),e.jsx("dd",{children:E(s.monthlyDebt)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Bankruptcy filed"}),e.jsx("dd",{children:s.bankruptcyFiledYear??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Rental history"}),e.jsx("dd",{children:s.rentalHistoryComments??"—"})]})]})]}),e.jsxs("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Screening insights"}),s.screenedAt?e.jsxs("dl",{className:"mt-3 space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Score"}),e.jsx("dd",{children:s.screeningScore??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Recommendation"}),e.jsx("dd",{children:_[s.recommendation]??s.recommendation??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Evaluated"}),e.jsx("dd",{children:y(s.screenedAt)})]}),s.screeningDetails&&e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Summary"}),e.jsx("dd",{children:s.screeningDetails})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-700",children:"Reasons"}),e.jsx("dd",{children:e.jsx("ul",{className:"mt-1 list-disc space-y-1 pl-4",children:a.map((t,h)=>e.jsx("li",{children:t},h))})})]})]}):e.jsx("p",{className:"mt-3 text-xs text-gray-500",children:"Screening has not been run yet. Capture income, credit, and debt to score the application."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Notes"}),s.manualNotes&&s.manualNotes.length>0?e.jsx("ul",{className:"space-y-2 text-xs",children:s.manualNotes.map(t=>e.jsxs("li",{className:"rounded border border-gray-200 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:t.author?.username??t.author?.name??"System"}),e.jsx("span",{className:"text-[11px] text-gray-500",children:y(t.createdAt)})]}),e.jsx("p",{className:"mt-1 text-[12px] text-gray-600",children:t.body})]},t.id))}):e.jsx("p",{className:"text-xs text-gray-500",children:"No notes logged yet."}),e.jsxs("div",{className:"rounded border border-gray-200 bg-white p-3 text-xs",children:[e.jsx("textarea",{rows:2,value:n,onChange:t=>j(h=>({...h,[s.id]:t.target.value})),placeholder:"Add an internal note for your team…",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>O(s.id),disabled:N===s.id||!n.trim(),className:"inline-flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 disabled:cursor-not-allowed disabled:bg-indigo-300",children:N===s.id?"Saving…":"Add note"})})]})]})]})]},s.id)})})]})};export{K as default};
