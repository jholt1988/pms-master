import{r,j as e}from"./react-vendor-Cz9WDxg-.js";import{c as j,d as L,e as E,k as P,a as u,b as f,n as D}from"./nextui-vendor-BpFfdwSS.js";import{a as R}from"./apiClient-DATCuIGb.js";import"./vendor-BVwjo9X5.js";import"./framer-motion-hFs7l1RU.js";const $=({recommendation:t,onAccept:p,onReject:N,loading:x=!1})=>{const[i,l]=r.useState(null),o=t.recommendedRent-t.currentRent,b=(o/t.currentRent*100).toFixed(1),c=o>0,y=async()=>{l("accept"),await p(t.unitId,t.recommendedRent),l(null)},v=async()=>{l("reject"),await N(t.unitId),l(null)};return e.jsxs(j,{className:"w-full",children:[e.jsxs(L,{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Unit #",t.unitId]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Generated ",new Date(t.generatedAt).toLocaleDateString()]})]}),e.jsx(E,{color:t.status==="accepted"?"success":t.status==="rejected"?"danger":"warning",variant:"flat",children:t.status.toUpperCase()})]}),e.jsx(P,{}),e.jsxs(u,{className:"gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Rent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",t.currentRent]})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Recommended Rent"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["$",t.recommendedRent]}),e.jsxs("p",{className:`text-sm font-medium ${c?"text-green-600":"text-red-600"}`,children:[c?"+":"",b,"% (",c?"+":"","$",o,")"]})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Confidence Range"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm",children:["$",t.confidenceInterval.low]}),e.jsx("div",{className:"flex-1 mx-4 h-2 bg-gray-200 rounded-full relative",children:e.jsx("div",{className:"absolute h-full bg-blue-500 rounded-full",style:{left:"0%",width:"100%"}})}),e.jsxs("span",{className:"text-sm",children:["$",t.confidenceInterval.high]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Key Factors"}),e.jsx("div",{className:"space-y-2",children:t.factors.map((a,h)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:a.description})]}),e.jsxs(E,{size:"sm",color:a.impact>0?"success":a.impact<0?"danger":"default",variant:"flat",children:[a.impact>0?"+":"",a.impact>0?a.impact?.toFixed(1):a.impact.toFixed(1),"%"]})]},h))})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Market Comparables (",t.marketComparables.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.marketComparables.slice(0,3).map((a,h)=>e.jsx("div",{className:"p-2 bg-gray-50 rounded text-sm",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:a.address}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.bedrooms," bed • ",a.bathrooms," bath • ",a.sqft," sqft • ",a.distance," mi"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:["$",a.rent]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(a.similarity*100).toFixed(0),"% match"]})]})]})},h))})]}),t.reasoning&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"AI Analysis"}),e.jsx("p",{className:"text-sm text-blue-800",children:t.reasoning})]}),t.status==="pending"&&e.jsxs("div",{className:"flex gap-3 mt-2",children:[e.jsx(f,{color:"primary",className:"flex-1",onPress:y,isLoading:i==="accept"||x,isDisabled:i!==null,children:"Accept Recommendation"}),e.jsx(f,{color:"danger",variant:"flat",className:"flex-1",onPress:v,isLoading:i==="reject"||x,isDisabled:i!==null,children:"Reject"})]}),e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Model: ",t.modelVersion]})]})]})},G=()=>{const[t,p]=r.useState([]),[N,x]=r.useState(!0),[i,l]=r.useState(null),[o,b]=r.useState(!1),c=r.useCallback(()=>localStorage.getItem("token"),[]),y=r.useCallback(s=>{const n=(s??"").toLowerCase();return n==="accepted"?"accepted":n==="rejected"?"rejected":"pending"},[]),v=r.useCallback(s=>({id:s.id,unitId:String(s.unitId),currentRent:s.currentRent??0,recommendedRent:s.recommendedRent??0,confidenceInterval:{low:s.confidenceIntervalLow??0,high:s.confidenceIntervalHigh??0},factors:s.factors??[],marketComparables:s.marketComparables??[],modelVersion:s.modelVersion??"backend",generatedAt:s.generatedAt??s.createdAt??new Date().toISOString(),status:y(s.status),reasoning:s.reasoning??s.note??""}),[y]),a=r.useCallback(async()=>{x(!0),l(null);try{const s=c();if(!s){x(!1);return}const n=await R("/rent-recommendations",{token:s});if(!Array.isArray(n))throw new Error("Unexpected payload from rent recommendations API");p(n.map(v))}catch(s){l(s.message||"Unable to load rent recommendations")}finally{x(!1)}},[c,v]),h=r.useCallback(async()=>{b(!0),l(null);try{const s=c();if(!s)throw new Error("Authentication required");await R("/rent-recommendations/bulk-generate/all",{token:s,method:"POST"}),await a()}catch(s){l(s.message||"Failed to generate recommendations")}finally{b(!1)}},[a]);r.useEffect(()=>{h()},[c]);const w=async(s,n)=>{try{const d=t.find(m=>m.unitId===s);if(!d||!d.id){alert("Cannot accept recommendation: No ID found");return}const g=c();if(!g){alert("Authentication required");return}await R(`/rent-recommendations/${d.id}/accept`,{token:g,method:"POST"}),p(m=>m.map(S=>S.unitId===s?{...S,status:"accepted"}:S)),alert(`Rent recommendation accepted for unit ${s}!`)}catch(d){console.error("Error accepting recommendation:",d),alert(`Error: ${d.message||"Failed to accept recommendation"}`)}},A=async s=>{try{const n=t.find(g=>g.unitId===s);if(!n||!n.id){alert("Cannot reject recommendation: No ID found");return}const d=c();if(!d){alert("Authentication required");return}await R(`/rent-recommendations/${n.id}/reject`,{token:d,method:"POST"}),p(g=>g.map(m=>m.unitId===s?{...m,status:"rejected"}:m)),alert(`Rent recommendation rejected for unit ${s}`)}catch(n){console.error("Error rejecting recommendation:",n),alert(`Error: ${n.message||"Failed to reject recommendation"}`)}};if(r.useEffect(()=>{a()},[a]),N)return e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(D,{size:"lg",label:"Loading rent recommendations..."})});if(i)return e.jsx("div",{className:"p-8",children:e.jsx(j,{className:"bg-red-50 border border-red-200",children:e.jsxs(u,{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error Loading Recommendations"}),e.jsx("p",{className:"text-red-700 mb-4",children:i}),e.jsx(f,{color:"danger",variant:"flat",onPress:a,children:"Retry"})]})})});const I=t.filter(s=>s.status==="pending"),k=t.filter(s=>s.status==="accepted"),C=t.filter(s=>s.status==="rejected");return e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Rent Optimization"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"AI-powered rent recommendations based on market analysis"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{color:"success",onPress:h,isLoading:o,children:o?"Generating…":"Generate New"}),e.jsx(f,{color:"primary",variant:"flat",onPress:a,isDisabled:N||o,children:"Refresh"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(j,{children:e.jsxs(u,{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Pending Review"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:I.length})]})}),e.jsx(j,{children:e.jsxs(u,{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Accepted"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:k.length})]})}),e.jsx(j,{children:e.jsxs(u,{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Rejected"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:C.length})]})})]}),I.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Pending Recommendations"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:I.map(s=>e.jsx($,{recommendation:s,onAccept:w,onReject:A},s.unitId))})]}),k.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Accepted Recommendations"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:k.map(s=>e.jsx($,{recommendation:s,onAccept:w,onReject:A},s.unitId))})]}),C.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Rejected Recommendations"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:C.map(s=>e.jsx($,{recommendation:s,onAccept:w,onReject:A},s.unitId))})]}),t.length===0&&e.jsx(j,{children:e.jsxs(u,{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No rent recommendations available"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Recommendations will appear here once generated"})]})})]})};export{G as RentOptimizationDashboard,G as default};
