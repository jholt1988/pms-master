import{r as l,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as F}from"./index-BHiZdJVs.js";import{a as I}from"./apiClient-DATCuIGb.js";import"./vendor-BVwjo9X5.js";import"./nextui-vendor-BpFfdwSS.js";import"./framer-motion-hFs7l1RU.js";import"./utils-vendor-9uJw-9S8.js";import"./lucide-icons-D0L7Z31B.js";function k(){const{token:x}=F(),[n,j]=l.useState("rent-roll"),[b,i]=l.useState(!1),[h,m]=l.useState(null),[d,u]=l.useState(null),[t,p]=l.useState({propertyId:"",startDate:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]});l.useEffect(()=>{n&&N()},[n,t]);const N=async()=>{if(!x){i(!1);return}i(!0),m(null);try{const r=new URLSearchParams;t.propertyId&&r.append("propertyId",t.propertyId),t.startDate&&r.append("startDate",t.startDate),t.endDate&&r.append("endDate",t.endDate);const s=await I(`/reporting/${n}?${r}`,{token:x});u(s)}catch(r){m(r.message||"Failed to load report")}finally{i(!1)}},c=(r,s)=>{if(!r||r.length===0)return;const a=Object.keys(r[0]),R=[a.join(","),...r.map(D=>a.map(S=>JSON.stringify(D[S]||"")).join(","))].join(`
`),C=new Blob([R],{type:"text/csv"}),y=window.URL.createObjectURL(C),o=document.createElement("a");o.href=y,o.download=`${s}.csv`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(y),document.body.removeChild(o)},g=()=>{const r=d;return!r||r.length===0?e.jsx("div",{children:"No data available"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>c(r,"rent-roll"),className:"bg-green-500 hover:bg-green-700 text-white px-4 py-2 rounded",children:"Export to CSV"})}),e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Property"}),e.jsx("th",{className:"border px-4 py-2",children:"Unit"}),e.jsx("th",{className:"border px-4 py-2",children:"Tenant"}),e.jsx("th",{className:"border px-4 py-2",children:"Rent Amount"}),e.jsx("th",{className:"border px-4 py-2",children:"Status"}),e.jsx("th",{className:"border px-4 py-2",children:"Current Balance"}),e.jsx("th",{className:"border px-4 py-2",children:"Unpaid Invoices"}),e.jsx("th",{className:"border px-4 py-2",children:"Total Unpaid"})]})}),e.jsx("tbody",{children:r.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:s.property}),e.jsx("td",{className:"border px-4 py-2",children:s.unit}),e.jsx("td",{className:"border px-4 py-2",children:s.tenant}),e.jsxs("td",{className:"border px-4 py-2",children:["$",s.rentAmount.toFixed(2)]}),e.jsx("td",{className:"border px-4 py-2",children:s.status}),e.jsxs("td",{className:"border px-4 py-2",children:["$",s.currentBalance.toFixed(2)]}),e.jsx("td",{className:"border px-4 py-2",children:s.unpaidInvoices}),e.jsxs("td",{className:"border px-4 py-2",children:["$",s.totalUnpaid.toFixed(2)]})]},a))})]})]})},v=()=>{const r=d;return!r||r.length===0?e.jsx("div",{children:"No data available"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>c(r,"profit-loss"),className:"bg-green-500 hover:bg-green-700 text-white px-4 py-2 rounded",children:"Export to CSV"})}),e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Property"}),e.jsx("th",{className:"border px-4 py-2",children:"Income"}),e.jsx("th",{className:"border px-4 py-2",children:"Expenses"}),e.jsx("th",{className:"border px-4 py-2",children:"Net Income"}),e.jsx("th",{className:"border px-4 py-2",children:"Margin %"})]})}),e.jsx("tbody",{children:r.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:s.property}),e.jsxs("td",{className:"border px-4 py-2",children:["$",s.income.toFixed(2)]}),e.jsxs("td",{className:"border px-4 py-2",children:["$",s.expenses.toFixed(2)]}),e.jsxs("td",{className:"border px-4 py-2",children:["$",s.netIncome.toFixed(2)]}),e.jsxs("td",{className:"border px-4 py-2",children:[s.margin.toFixed(2),"%"]})]},a))})]})]})},f=()=>{const r=d;return r?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded",children:[e.jsx("h3",{className:"font-bold",children:"Total Completed"}),e.jsx("p",{className:"text-2xl",children:r.totalCompleted})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded",children:[e.jsx("h3",{className:"font-bold",children:"Average Resolution Time"}),e.jsxs("p",{className:"text-2xl",children:[r.averageResolutionTimeDays.toFixed(1)," days"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["(",r.averageResolutionTimeHours.toFixed(1)," hours)"]})]})]}),e.jsx("h3",{className:"font-bold mb-4",children:"By Priority"}),e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Priority"}),e.jsx("th",{className:"border px-4 py-2",children:"Count"}),e.jsx("th",{className:"border px-4 py-2",children:"Average Hours"})]})}),e.jsx("tbody",{children:Object.entries(r.byPriority).map(([s,a])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:s}),e.jsx("td",{className:"border px-4 py-2",children:a.count}),e.jsx("td",{className:"border px-4 py-2",children:a.averageHours.toFixed(1)})]},s))})]})]}):e.jsx("div",{children:"No data available"})},w=()=>{const r=d;return!r||r.length===0?e.jsx("div",{children:"No data available"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>c(r,"vacancy-rate"),className:"bg-green-500 hover:bg-green-700 text-white px-4 py-2 rounded",children:"Export to CSV"})}),e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Property"}),e.jsx("th",{className:"border px-4 py-2",children:"Total Units"}),e.jsx("th",{className:"border px-4 py-2",children:"Occupied"}),e.jsx("th",{className:"border px-4 py-2",children:"Vacant"}),e.jsx("th",{className:"border px-4 py-2",children:"Vacancy Rate %"})]})}),e.jsx("tbody",{children:r.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:s.property}),e.jsx("td",{className:"border px-4 py-2",children:s.totalUnits}),e.jsx("td",{className:"border px-4 py-2",children:s.occupiedUnits}),e.jsx("td",{className:"border px-4 py-2",children:s.vacantUnits}),e.jsxs("td",{className:"border px-4 py-2",children:[s.vacancyRate,"%"]})]},a))})]})]})};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Reports & Analytics"}),e.jsxs("div",{className:"mb-6 flex gap-4",children:[e.jsxs("select",{value:n,onChange:r=>j(r.target.value),className:"border rounded px-4 py-2",children:[e.jsx("option",{value:"rent-roll",children:"Rent Roll"}),e.jsx("option",{value:"profit-loss",children:"Profit & Loss"}),e.jsx("option",{value:"maintenance-analytics",children:"Maintenance Analytics"}),e.jsx("option",{value:"vacancy-rate",children:"Vacancy Rate"}),e.jsx("option",{value:"payment-history",children:"Payment History"})]}),e.jsx("input",{type:"date",value:t.startDate,onChange:r=>p({...t,startDate:r.target.value}),className:"border rounded px-4 py-2"}),e.jsx("input",{type:"date",value:t.endDate,onChange:r=>p({...t,endDate:r.target.value}),className:"border rounded px-4 py-2"}),e.jsx("input",{type:"text",placeholder:"Property ID (optional)",value:t.propertyId,onChange:r=>p({...t,propertyId:r.target.value}),className:"border rounded px-4 py-2"})]}),h&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:h}),b?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[n==="rent-roll"&&g(),n==="profit-loss"&&v(),n==="maintenance-analytics"&&f(),n==="vacancy-rate"&&w(),n==="payment-history"&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>c(d||[],"payment-history"),className:"bg-green-500 hover:bg-green-700 text-white px-4 py-2 rounded mb-4",children:"Export to CSV"}),e.jsx("pre",{children:JSON.stringify(d,null,2)})]})]})]})}export{k as default};
