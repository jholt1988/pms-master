import{j as e,r as a}from"./react-vendor-Cz9WDxg-.js";import{u as me}from"./index-BHiZdJVs.js";import{a as C}from"./apiClient-DATCuIGb.js";import{S as R,D as pe}from"./DataTable-D59aytRp.js";import{P as xe}from"./PageHeader-mjJTmpC5.js";import{c as S,a as w,s as D,l as _,u as ge,b as g,m as he,f as fe,g as ye,h as be,i as L,j as je}from"./nextui-vendor-BpFfdwSS.js";import"./vendor-BVwjo9X5.js";import"./utils-vendor-9uJw-9S8.js";import"./lucide-icons-D0L7Z31B.js";import"./framer-motion-hFs7l1RU.js";import"./useViewportCategory-ClZR3Wdj.js";const ve=({title:n,description:l,filters:A})=>e.jsx(S,{className:"shadow-medium",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-foreground",children:n}),e.jsx("p",{className:"mt-1 text-sm text-foreground-500",children:l})]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:A.map(r=>e.jsxs("div",{className:"flex flex-col text-xs font-medium text-foreground-700",children:[e.jsx("label",{className:"mb-1",children:r.label}),e.jsx(D,{size:"sm",selectedKeys:r.value?[r.value]:[],onChange:c=>r.onChange({target:{name:r.name,value:c.target.value}}),isDisabled:r.disabled,className:"w-40","aria-label":`Filter by ${r.label.toLowerCase()}`,children:[{value:"",label:r.label==="Status"||r.label==="Priority"?"All":"Any"},...r.options].map(c=>e.jsx(_,{value:c.value,children:c.label},c.value||"empty"))})]},r.name))})]})})}),se=["MAINTENANCE","UTILITIES","TAXES","INSURANCE","REPAIRS","OTHER"],h=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n),E=n=>n.toLowerCase().replace("_"," ").replace(/\b\w/g,l=>l.toUpperCase()),ke=()=>{const{token:n}=me(),[l,A]=a.useState([]),[r,c]=a.useState([]),[ae,$]=a.useState(!0),[O,p]=a.useState(null),[q,z]=a.useState(!1),[K,H]=a.useState(null),[u,B]=a.useState(""),[f,P]=a.useState(""),[y,X]=a.useState(""),[i,Y]=a.useState(""),[b,F]=a.useState(""),[T,G]=a.useState(""),[k,J]=a.useState(""),[U,Q]=a.useState(""),[j,V]=a.useState(""),{isOpen:re,onOpen:ne,onOpenChange:W}=ge(),Z=a.useMemo(()=>{const t=l.reduce((x,M)=>x+M.amount,0),s=new Date,o=new Date(s.getFullYear(),s.getMonth(),1),d=l.filter(x=>new Date(x.date)>=o).reduce((x,M)=>x+M.amount,0);return{overall:t,recent:d}},[l]),v=a.useMemo(()=>{const t=l.reduce((o,d)=>(o[d.category]=(o[d.category]||0)+d.amount,o),{}),s=Object.entries(t);return s.length>0?s.reduce((o,d)=>d[1]>o[1]?d:o):null},[l]),m=a.useMemo(()=>l.filter(t=>!(u&&t.property?.id!==Number(u)||f&&t.unit?.id!==Number(f)||y&&t.category!==y)),[l,u,f,y]),ee=a.useMemo(()=>u?r.find(s=>s.id===Number(u))?.units||[]:[],[u,r]),te=a.useMemo(()=>i?r.find(s=>s.id===Number(i))?.units||[]:[],[i,r]),N=a.useCallback(async()=>{if(n)try{$(!0),p(null);const[t,s]=await Promise.all([C("/expenses",{token:n}),C("/properties",{token:n})]);A(t),c(s)}catch(t){console.error("Error fetching data:",t),p(t instanceof Error?t.message:"Failed to fetch data")}finally{$(!1)}},[n]);a.useEffect(()=>{N()},[N]);const I=t=>{const{name:s,value:o}=t.target;s==="property"?(B(o),P("")):s==="unit"?P(o):s==="category"&&X(o)},le=()=>{B(""),P(""),X("")},oe=async()=>{if(!(!n||q))try{z(!0),p(null),await C("/expenses",{token:n,method:"POST",body:{description:T,amount:parseFloat(k),date:U,category:j,propertyId:i?Number(i):void 0,unitId:b?Number(b):void 0}}),G(""),J(""),Q(""),V(""),Y(""),F(""),await N(),W()}catch(t){console.error("Error adding expense:",t),p(t instanceof Error?t.message:"Failed to add expense")}finally{z(!1)}},ie=async t=>{if(!(!n||K))try{H(t),p(null),await C(`/expenses/${t}`,{token:n,method:"DELETE"}),await N()}catch(s){console.error("Error deleting expense:",s),p(s instanceof Error?s.message:"Failed to delete expense")}finally{H(null)}};if(!n)return e.jsx("div",{className:"p-4",children:e.jsx(S,{children:e.jsx(w,{className:"text-center",children:"Please sign in to view expense tracking."})})});const de=[{label:"Dashboard",href:"/"},{label:"Expense Tracking"}],ce=[{name:"property",label:"Property",value:u,options:r.map(t=>({value:String(t.id),label:t.name})),onChange:I},{name:"unit",label:"Unit",value:f,options:ee.map(t=>({value:String(t.id),label:t.name})),disabled:ee.length===0,onChange:I},{name:"category",label:"Category",value:y,options:se.map(t=>({value:t,label:E(t)})),onChange:I}],ue=[{key:"description",label:"Description",render:t=>t.description},{key:"property",label:"Property / Unit",render:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.property?.name||"No property"}),t.unit&&e.jsx("div",{className:"text-sm text-foreground-500",children:t.unit.name})]})},{key:"category",label:"Category",render:t=>E(t.category)},{key:"date",label:"Date",render:t=>new Date(t.date).toLocaleDateString()},{key:"amount",label:"Amount",render:t=>h(t.amount)},{key:"actions",label:"Actions",render:t=>e.jsx(g,{color:"danger",size:"sm",variant:"flat",isLoading:K===t.id,onClick:()=>ie(t.id),children:"Delete"})}];return e.jsxs("div",{className:"space-y-8",children:[e.jsx(xe,{title:"Expense Tracking",subtitle:"Monitor property operating costs, slice spend by category, and log reimbursable items.",breadcrumbs:de,actions:e.jsx(g,{color:"primary",onPress:ne,children:"Add Expense"})}),O&&e.jsx(S,{className:"border-danger-200 bg-danger-50",children:e.jsx(w,{children:e.jsx("p",{className:"text-sm text-danger-700",children:O})})}),e.jsxs("section",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(R,{title:"Total Spend",value:h(Z.overall),valueColor:"default"}),e.jsx(R,{title:"This Month",value:h(Z.recent),valueColor:"warning"}),e.jsx(R,{title:"Top Category",value:v?h(v[1]):"$0",valueColor:"primary",subtitle:v?E(v[0]):"No expenses yet"})]}),e.jsx(ve,{title:"Filter Ledger",description:"Narrow results by property, unit, or category.",filters:ce}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{variant:"flat",onClick:le,size:"sm",children:"Reset Filters"})}),e.jsxs("div",{className:"grid gap-8 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[e.jsx("section",{children:e.jsx(pe,{title:"Expense Ledger",subtitle:`${m.length} record${m.length===1?"":"s"} selected.`,columns:ue,data:m,loading:ae,emptyContent:"No expenses found."})}),e.jsx("aside",{className:"space-y-4",children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Expense Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Expenses:"}),e.jsx("span",{className:"font-medium",children:l.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Filtered Results:"}),e.jsx("span",{className:"font-medium",children:m.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Average Amount:"}),e.jsx("span",{className:"font-medium",children:m.length>0?h(m.reduce((t,s)=>t+s.amount,0)/m.length):"$0"})]})]})]})})})]}),e.jsx(he,{isOpen:re,onOpenChange:W,size:"2xl",children:e.jsx(fe,{children:t=>e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:"Add New Expense"}),e.jsx(be,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(L,{label:"Description",value:T,onChange:s=>G(s.target.value),placeholder:"Enter expense description",isRequired:!0}),e.jsx(L,{label:"Amount",type:"number",value:k,onChange:s=>J(s.target.value),placeholder:"0.00",startContent:"$",isRequired:!0}),e.jsx(L,{label:"Date",type:"date",value:U,onChange:s=>Q(s.target.value),isRequired:!0}),e.jsx(D,{label:"Category",selectedKeys:j?[j]:[],onChange:s=>V(s.target.value),isRequired:!0,children:se.map(s=>e.jsx(_,{value:s,children:E(s)},s))}),e.jsx(D,{label:"Property",selectedKeys:i?[i]:[],onChange:s=>{Y(s.target.value),F("")},children:[{id:"",name:"No property"},...r].map(s=>e.jsx(_,{value:String(s.id),children:s.name},s.id||"none"))}),e.jsx(D,{label:"Unit",selectedKeys:b?[b]:[],onChange:s=>F(s.target.value),isDisabled:!i||te.length===0,children:[{id:"",name:"No unit"},...te].map(s=>e.jsx(_,{value:String(s.id),children:s.name},s.id||"none"))})]})}),e.jsxs(je,{children:[e.jsx(g,{variant:"flat",onPress:t,children:"Cancel"}),e.jsx(g,{color:"primary",onPress:oe,isLoading:q,isDisabled:!T||!k||!U||!j,children:"Add Expense"})]})]})})})]})};export{ke as default};
