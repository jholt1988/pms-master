import{r as l,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as _}from"./index-BHiZdJVs.js";import{a as G}from"./EsignatureApi-DO8imZh3.js";import{a as w}from"./apiClient-DATCuIGb.js";import"./vendor-BVwjo9X5.js";import"./nextui-vendor-BpFfdwSS.js";import"./framer-motion-hFs7l1RU.js";import"./utils-vendor-9uJw-9S8.js";import"./lucide-icons-D0L7Z31B.js";const V=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),H={DRAFT:"Draft",PENDING_APPROVAL:"Pending Approval",ACTIVE:"Active",RENEWAL_PENDING:"Renewal Pending",NOTICE_GIVEN:"Notice Given",TERMINATING:"Terminating",TERMINATED:"Terminated",HOLDOVER:"Holdover",CLOSED:"Closed"},U={ACTIVE:"bg-emerald-100 text-emerald-700",RENEWAL_PENDING:"bg-amber-100 text-amber-700",NOTICE_GIVEN:"bg-orange-100 text-orange-700",TERMINATING:"bg-rose-100 text-rose-700",TERMINATED:"bg-red-100 text-red-700"},P=()=>({type:"MOVE_OUT",desiredMoveOut:"",message:""}),o=a=>{if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?"—":s.toLocaleDateString()},E=a=>{if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?"—":s.toLocaleString()},B=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),Y=a=>{if(!B(a))return[];const s=[],{decision:x,renewalOfferId:y,respondedAt:p,noticeType:c,submittedAt:d,requestedMoveOut:u,message:i}=a;return typeof x=="string"&&s.push(`Decision: ${x}`),typeof y=="number"&&s.push(`Offer #${y}`),typeof p=="string"&&s.push(`Responded ${E(p)}`),typeof c=="string"&&s.push(`Notice type: ${c.replace("_"," ")}`),typeof d=="string"&&s.push(`Submitted ${E(d)}`),typeof u=="string"&&s.push(`Requested move-out: ${o(u)}`),typeof i=="string"&&i.trim().length>0&&s.push(`Note: ${i.trim()}`),s},h=a=>a==null?"—":V.format(a),te=()=>{const{token:a}=_(),[s,x]=l.useState(null),[y,p]=l.useState(!0),[c,d]=l.useState(null),[u,i]=l.useState(null),[m,v]=l.useState(P),[A,S]=l.useState(!1),[N,D]=l.useState(null),[R,O]=l.useState({}),[g,j]=l.useState({loading:!1,message:null,error:null});l.useEffect(()=>{(async()=>{if(!a){p(!1);return}p(!0),d(null);try{const r=await w("/leases/my-lease",{token:a});x(r);const n={};(r.renewalOffers??[]).forEach(b=>{n[b.id]=""}),O(n)}catch(r){d(r instanceof Error?r.message:"Unable to load lease details.")}finally{p(!1)}})()},[a]);const I=async t=>{if(a){j({loading:!0,message:null,error:null});try{const r=await G(a,t,window.location.href);window.open(r,"_blank"),j({loading:!1,message:"Signing session opened in a new tab.",error:null})}catch(r){j({loading:!1,message:null,error:r instanceof Error?r.message:"Unable to launch signing session."})}}},T=l.useMemo(()=>(s?.renewalOffers??[]).filter(t=>t.status==="OFFERED"),[s]),C=l.useMemo(()=>(s?.renewalOffers??[]).filter(t=>t.status!=="OFFERED"),[s]),M=l.useMemo(()=>(s?.history??[]).slice(0,5),[s]),$=(t,r)=>{O(n=>({...n,[t]:r})),i(null),d(null)},L=async(t,r)=>{if(!(!s||!a)){D(t.id),i(null),d(null);try{const n=await w(`/leases/${s.id}/renewal-offers/${t.id}/respond`,{token:a,method:"POST",body:{decision:r,message:R[t.id]?.trim()||void 0}});x(n),i(r==="ACCEPTED"?"Thanks! Your renewal acceptance was recorded.":"Your decline was submitted to the property manager.")}catch(n){d(n instanceof Error?n.message:"Unable to submit renewal response.")}finally{D(null)}}},f=(t,r)=>{v(n=>({...n,[t]:r})),i(null),d(null)},k=async()=>{if(!(!s||!a)){if(!m.desiredMoveOut){d("Please choose a desired move-out date.");return}S(!0),i(null),d(null);try{const t=await w(`/leases/${s.id}/tenant-notices`,{token:a,method:"POST",body:{type:m.type,moveOutAt:m.desiredMoveOut,message:m.message.trim()||void 0}});x(t),v(P()),i("Your move-out intent has been sent to the property team.")}catch(t){d(t instanceof Error?t.message:"Unable to submit your notice.")}finally{S(!1)}}};if(y)return e.jsx("div",{className:"p-4 text-sm text-gray-600",children:"Loading your lease…"});if(c&&!s)return e.jsx("div",{className:"p-4 text-sm text-red-600",children:c});if(!s)return e.jsx("div",{className:"p-4 text-sm text-gray-600",children:"We could not find an active lease tied to your account. Please contact your property manager."});const F=U[s.status]??"bg-gray-200 text-gray-700";return e.jsxs("div",{className:"container mx-auto space-y-6 p-4",children:[e.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Current Lease"}),e.jsxs("h1",{className:"text-2xl font-semibold text-gray-900",children:[s.unit.property?`${s.unit.property.name}`:"Property"," · ",s.unit.name]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[o(s.startDate)," – ",o(s.endDate)," · ",s.noticePeriodDays??30," day notice"]})]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${F}`,children:H[s.status]})]}),(u||c)&&e.jsx("div",{className:`rounded-md border px-4 py-3 text-sm ${u?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-rose-200 bg-rose-50 text-rose-700"}`,children:u??c}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Monthly Rent"}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-gray-900",children:h(s.rentAmount)}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Balance snapshot: ",h(s.currentBalance)]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Security Deposit"}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-gray-900",children:h(s.depositAmount)}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:[s.depositHeldAt?`Held since ${o(s.depositHeldAt)}`:"Receipt pending",s.depositReturnedAt&&` · Returned ${o(s.depositReturnedAt)}`]}),s.depositDisposition&&e.jsxs("p",{className:"mt-2 text-xs font-medium text-gray-600",children:["Disposition: ",s.depositDisposition.replace("_"," ")]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Autopay"}),s.autopayEnrollment?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mt-1 text-xl font-semibold text-gray-900",children:s.autopayEnrollment.active?"Active":"Paused"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:s.autopayEnrollment.paymentMethod?`${s.autopayEnrollment.paymentMethod.brand??s.autopayEnrollment.paymentMethod.provider} ${s.autopayEnrollment.paymentMethod.last4?`• ${s.autopayEnrollment.paymentMethod.last4}`:""}`:"Payment method on file"}),s.autopayEnrollment.maxAmount!=null&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Max draft: ",h(s.autopayEnrollment.maxAmount)]})]}):e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Autopay not enrolled."}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Auto-renew ",s.autoRenew?"enabled":"disabled",s.autoRenewLeadDays!=null&&` · Lead time ${s.autoRenewLeadDays} days`]})]})]}),e.jsxs("section",{className:"space-y-3 rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("header",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Track outstanding lease packets and launch signing sessions."})]})}),g.error&&e.jsx("p",{className:"rounded border border-rose-200 bg-rose-50 p-2 text-xs text-rose-700",children:g.error}),g.message&&e.jsx("p",{className:"rounded border border-emerald-200 bg-emerald-50 p-2 text-xs text-emerald-700",children:g.message}),(s?.esignEnvelopes??[]).length===0?e.jsx("p",{className:"text-sm text-gray-600",children:"No signature packets have been sent yet."}):e.jsx("div",{className:"space-y-3",children:s?.esignEnvelopes?.map(t=>{const r=t.participants?.find(b=>b.userId===s?.tenant?.id||b.email===s?.tenant?.username),n=t.status==="COMPLETED"||r?.status==="SIGNED";return e.jsxs("div",{className:"rounded border border-gray-200 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Envelope #",t.id]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(t.createdAt).toLocaleString()," · Provider ",t.provider]})]}),e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-700",children:r?.status??t.status})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Status: ",t.status]}),!n&&e.jsx("button",{type:"button",className:"rounded bg-indigo-600 px-3 py-1 text-xs font-semibold text-white disabled:bg-indigo-300",onClick:()=>I(t.id),disabled:g.loading,children:g.loading?"Launching…":"Launch Signing Session"})]})]},t.id)})})]}),e.jsxs("section",{className:"space-y-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Renewal Offers"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Review terms and let us know if you plan to stay or move out."})]}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["Renewal decision due ",o(s.renewalDueAt)]})]}),T.length>0?e.jsx("div",{className:"space-y-3",children:T.map(t=>e.jsxs("div",{className:"space-y-3 rounded border border-amber-200 bg-amber-50 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-amber-800",children:[h(t.proposedRent)," per month"]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[o(t.proposedStart)," – ",o(t.proposedEnd)]})]}),e.jsxs("p",{className:"text-xs text-amber-700",children:["Expires ",o(t.expiresAt)," · Sent ",o(t.createdAt)]})]}),t.message&&e.jsx("p",{className:"text-sm text-amber-900",children:t.message}),e.jsx("textarea",{className:"w-full rounded border border-amber-200 bg-white px-2 py-1 text-sm focus:border-amber-400 focus:outline-none",placeholder:"Add a note (optional)…",value:R[t.id]??"",onChange:r=>$(t.id,r.target.value)}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",className:"rounded bg-emerald-600 px-3 py-1 text-sm font-semibold text-white hover:bg-emerald-500 disabled:cursor-not-allowed disabled:bg-emerald-300",onClick:()=>L(t,"ACCEPTED"),disabled:N===t.id,children:N===t.id?"Submitting…":"Accept offer"}),e.jsx("button",{type:"button",className:"rounded border border-amber-500 px-3 py-1 text-sm font-semibold text-amber-700 hover:bg-amber-100 disabled:cursor-not-allowed disabled:border-amber-200 disabled:text-amber-300",onClick:()=>L(t,"DECLINED"),disabled:N===t.id,children:"Decline"})]})]},t.id))}):e.jsx("p",{className:"text-sm text-gray-600",children:"No open renewal offers at this time."}),C.length>0&&e.jsxs("div",{className:"space-y-2 rounded border border-gray-200 bg-gray-50 p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Previous decisions"}),e.jsx("ul",{className:"space-y-2 text-xs text-gray-600",children:C.map(t=>e.jsxs("li",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("span",{children:[h(t.proposedRent)," · ",o(t.proposedStart)," –"," ",o(t.proposedEnd)]}),e.jsx("span",{className:"font-medium",children:t.status})]},t.id))})]})]}),e.jsxs("section",{className:"space-y-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Plan a Move-Out"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Submit your proposed move-out date so the property team can coordinate inspections and deposits."})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Notice type",e.jsxs("select",{className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",value:m.type,onChange:t=>f("type",t.target.value),children:[e.jsx("option",{value:"MOVE_OUT",children:"Move-out"}),e.jsx("option",{value:"RENT_INCREASE",children:"Rent concern"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Desired move-out date",e.jsx("input",{type:"date",className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",value:m.desiredMoveOut,onChange:t=>f("desiredMoveOut",t.target.value)})]}),e.jsxs("label",{className:"text-xs font-medium text-gray-700 md:col-span-2",children:["Notes for the property team",e.jsx("textarea",{rows:3,className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",value:m.message,placeholder:"Share any special considerations (cleaning, forwarding address, pets, etc.)",onChange:t=>f("message",t.target.value)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"rounded bg-gray-900 px-4 py-2 text-sm font-semibold text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:bg-gray-400",onClick:k,disabled:A,children:A?"Sending…":"Send notice"})}),e.jsxs("div",{className:"space-y-2 rounded border border-gray-200 bg-gray-50 p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Your recent notices"}),s.notices&&s.notices.length>0?e.jsx("ul",{className:"space-y-2 text-xs text-gray-600",children:s.notices.map(t=>e.jsxs("li",{className:"flex flex-wrap justify-between gap-2",children:[e.jsxs("span",{children:[t.type.replace("_"," ")," · ",o(t.sentAt),t.message&&` — ${t.message}`]}),e.jsx("span",{children:t.deliveryMethod.toLowerCase()})]},t.id))}):e.jsx("p",{className:"text-xs text-gray-500",children:"No notices recorded yet."})]})]}),e.jsxs("section",{className:"space-y-3 rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Track renewal decisions, notices, and other changes logged on your lease."})]}),M.length>0?e.jsx("ul",{className:"space-y-3",children:M.map(t=>{const r=Y(t.metadata);return e.jsxs("li",{className:"rounded border border-gray-200 bg-gray-50 p-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:t.note??"Lease update recorded"}),e.jsx("span",{className:"text-xs text-gray-500",children:E(t.createdAt)})]}),t.actor&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Recorded by ",t.actor.username]}),r.length>0&&e.jsx("ul",{className:"mt-2 space-y-1 text-xs text-gray-600",children:r.map(n=>e.jsx("li",{children:n},n))})]},t.id)})}):e.jsx("p",{className:"text-sm text-gray-600",children:"No recent updates yet. Actions you take here will show up shortly."})]})]})};export{te as MyLeasePage};
