import{j as e,r as l}from"./react-vendor-Cz9WDxg-.js";import{u as O}from"./index-BHiZdJVs.js";import{a as P}from"./apiClient-DATCuIGb.js";import{u as _}from"./useViewportCategory-ClZR3Wdj.js";import{P as $}from"./PageHeader-mjJTmpC5.js";import{c as j,d as F,e as G,a as N,b as M}from"./nextui-vendor-BpFfdwSS.js";import{f as V}from"./utils-vendor-9uJw-9S8.js";import{c as q}from"./EsignatureApi-DO8imZh3.js";import{u as z,M as H}from"./useMasterDetail-BdXesFbU.js";import{g as U}from"./lucide-icons-D0L7Z31B.js";import"./vendor-BVwjo9X5.js";import"./framer-motion-hFs7l1RU.js";const B=a=>{switch(a.toUpperCase()){case"ACTIVE":return"success";case"DRAFT":return"default";case"PENDING_APPROVAL":return"warning";case"RENEWAL_PENDING":return"primary";case"NOTICE_GIVEN":return"warning";case"TERMINATING":return"danger";case"TERMINATED":return"danger";case"HOLDOVER":return"warning";case"CLOSED":return"default";default:return"default"}},W=a=>{try{return V(new Date(a),"MMM d, yyyy")}catch{return a}},J=({lease:a,onManage:d})=>e.jsxs(j,{className:"shadow-medium",children:[e.jsxs(F,{className:"flex-row items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:a.tenant?.username??"Tenant"}),e.jsxs("p",{className:"text-sm text-foreground-500",children:[a.unit.property?`${a.unit.property.name} · `:"",a.unit.name]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(G,{color:B(a.status),size:"sm",variant:"flat",children:a.status.replace("_"," ")}),e.jsxs("span",{className:"text-xs text-foreground-500",children:["End ",W(a.endDate)]})]})]}),e.jsx(N,{className:"px-4 py-3 pt-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[a.rentAmount&&e.jsxs("span",{className:"text-sm font-medium text-foreground",children:["$",a.rentAmount.toLocaleString(),"/mo"]}),e.jsx(M,{size:"sm",color:"primary",variant:"flat",onClick:()=>d(a.id),children:"Manage"})]})})]}),K={COMPLETED:"bg-emerald-100 text-emerald-700",SENT:"bg-blue-100 text-blue-700",DELIVERED:"bg-indigo-100 text-indigo-700",DECLINED:"bg-rose-100 text-rose-700",ERROR:"bg-amber-100 text-amber-700"},Q=({token:a,leaseId:d,tenantName:c,tenantEmail:i,tenantId:m,envelopes:h=[],onEnvelopeCreated:b})=>{const[n,y]=l.useState(""),[v,E]=l.useState(""),[f,u]=l.useState(!1),[D,w]=l.useState(null),[S,g]=l.useState(null),[x,r]=l.useState([]),L=l.useMemo(()=>[...h].sort((s,t)=>new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime()),[h]),A=l.useMemo(()=>{const s=[];return i&&s.push({name:c||i,email:i,role:"TENANT",userId:m}),x.forEach(t=>{t.email&&t.name&&s.push({name:t.name,email:t.email,role:t.role||"COSIGNER"})}),s},[i,c,m,x]),p=()=>{r(s=>[...s,{id:Date.now(),name:"",email:"",role:"COSIGNER"}])},C=(s,t,o)=>{r(k=>k.map(R=>R.id===s?{...R,[t]:o}:R))},T=s=>{r(t=>t.filter(o=>o.id!==s))},I=async s=>{s.preventDefault(),u(!0),w(null),g(null);const t={templateId:n,message:v||void 0,recipients:A};if(t.recipients.length===0){u(!1),g("Please provide at least one signer before sending.");return}try{const o=await q(a,d,t);b?.(o),w("Signature packet sent successfully."),y(""),E(""),r([])}catch(o){g(o instanceof Error?o.message:"Unable to send signature request.")}finally{u(!1)}};return e.jsxs("div",{className:"mt-4 rounded-lg border border-default-200 bg-default-50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Digital Signatures"}),e.jsx("p",{className:"text-xs text-foreground-500",children:"Launch DocuSign/HelloSign envelopes and track signer status."})]}),e.jsx("button",{type:"button",onClick:p,className:"text-xs font-medium text-primary",children:"+ Add Additional Signer"})]}),e.jsxs("form",{className:"mt-3 space-y-3",onSubmit:I,children:[D&&e.jsx("p",{className:"rounded bg-success-100 p-2 text-xs text-success-800",children:D}),S&&e.jsx("p",{className:"rounded bg-danger-100 p-2 text-xs text-danger-800",children:S}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-foreground",htmlFor:`template-${d}`,children:"Template ID"}),e.jsx("input",{id:`template-${d}`,type:"text",value:n,onChange:s=>y(s.target.value),className:"mt-1 w-full rounded border border-default-300 p-2 text-sm",placeholder:"e.g., STANDARD-LEASE",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-foreground",htmlFor:`message-${d}`,children:"Message to signers"}),e.jsx("textarea",{id:`message-${d}`,value:v,onChange:s=>E(s.target.value),className:"mt-1 w-full rounded border border-default-300 p-2 text-sm",rows:3,placeholder:"Share any notes for the recipients"})]}),x.length>0&&e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs("div",{className:"rounded border border-default-200 p-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s.name,onChange:t=>C(s.id,"name",t.target.value),className:"w-1/2 rounded border border-default-300 p-2 text-sm",placeholder:"Signer name"}),e.jsx("input",{type:"email",value:s.email,onChange:t=>C(s.id,"email",t.target.value),className:"w-1/2 rounded border border-default-300 p-2 text-sm",placeholder:"email@example.com"})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("input",{type:"text",value:s.role,onChange:t=>C(s.id,"role",t.target.value),className:"w-1/2 rounded border border-default-300 p-2 text-sm",placeholder:"Role (e.g., GUARANTOR)"}),e.jsx("button",{type:"button",onClick:()=>T(s.id),className:"text-xs font-medium text-danger",children:"Remove"})]})]},s.id))}),e.jsx("button",{type:"submit",disabled:f,className:"w-full rounded bg-primary px-4 py-2 text-sm font-medium text-white disabled:opacity-60",children:f?"Sending…":"Send Signature Request"})]}),e.jsx("div",{className:"mt-5 space-y-3",children:L.length===0?e.jsx("p",{className:"text-xs text-foreground-500",children:"No signature packets have been sent yet."}):L.map(s=>e.jsxs("div",{className:"rounded border border-default-200 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Envelope #",s.id]}),e.jsxs("p",{className:"text-xs text-foreground-500",children:[new Date(s.createdAt).toLocaleString()," • Provider ",s.provider]})]}),e.jsx("span",{className:`rounded px-2 py-1 text-xs font-semibold ${K[s.status]||"bg-default-200 text-default-700"}`,children:s.status})]}),e.jsx("div",{className:"mt-3 space-y-1 text-xs",children:s.participants.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[t.name," • ",t.role]}),e.jsx("span",{className:"font-semibold text-foreground-600",children:t.status})]},t.id))})]},s.id))})]})},ce=()=>{const{token:a}=O(),[d,c]=l.useState([]),[i,m]=l.useState(!0),[h,b]=l.useState(null),{selectedItem:n,showDetail:y,selectItem:v,clearSelection:E}=z(),f=_(),u=l.useCallback(async()=>{if(m(!0),b(null),!a){c([]),m(!1);return}try{const r=await P("/leases",{token:a});c(r?.data??r??[])}catch(r){b(r.message??"Failed to load leases"),c([])}finally{m(!1)}},[a]);l.useEffect(()=>{u()},[a,u]);const D=()=>{E()},w=(r,L)=>{c(A=>A.map(p=>p.id===r?{...p,esignEnvelopes:[L,...p.esignEnvelopes??[]]}:p))},S=[{label:"Dashboard",href:"/"},{label:"Lease Management"}],g=e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx($,{title:"Lease Lifecycle Manager",subtitle:"Track occupancy, renewals, and compliance so every lease stays on schedule.",breadcrumbs:S}),h&&e.jsx(j,{className:"border-danger-200 bg-danger-50",children:e.jsx(N,{children:e.jsx("p",{className:"text-sm text-danger-700",children:h})})}),e.jsx("section",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4 my-8"}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"All Leases"})}),i?e.jsx(j,{className:"border-dashed",children:e.jsx(N,{className:"py-12 text-center",children:e.jsx("p",{className:"text-sm text-foreground-500",children:"Loading leases…"})})}):d.length===0?e.jsx(j,{className:"border-dashed",children:e.jsx(N,{className:"py-12 text-center",children:e.jsx("p",{className:"text-sm text-foreground-500",children:"No leases found."})})}):e.jsx("div",{className:"space-y-4",children:d.map(r=>e.jsx("div",{onClick:()=>v(r),children:e.jsx(J,{lease:r,onManage:()=>{}})},r.id))})]})]}),x=e.jsx("div",{className:"p-4 sm:p-6",children:n?e.jsxs(e.Fragment,{children:[(f==="mobile"||f==="tablet-portrait")&&e.jsx(M,{isIconOnly:!0,variant:"light",onClick:D,className:"mb-4",children:e.jsx(U,{size:20})}),e.jsx(j,{children:e.jsx(N,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-2",children:"Lease Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Start Date:"})," ",new Date(n.startDate).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"End Date:"})," ",new Date(n.endDate).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Rent:"})," $",n.rentAmount.toLocaleString(),"/month"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Deposit:"})," $",n.depositAmount.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-2",children:"Actions"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Lease management actions will be available here based on the current status."}),a&&e.jsx(Q,{token:a,leaseId:n.id,tenantEmail:n.tenant?.username,tenantName:n.tenant?.username,tenantId:n.tenant?.id,envelopes:n.esignEnvelopes??[],onEnvelopeCreated:r=>w(n.id,r)})]})]})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500",children:"Select a lease to see the details"})})});return e.jsx(H,{master:g,detail:x,showDetail:y})};export{ce as default};
