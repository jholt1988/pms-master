import{r as n,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as De}from"./index-BHiZdJVs.js";import{u as Re,M as Ie}from"./useMasterDetail-BdXesFbU.js";import{u as Oe}from"./useViewportCategory-ClZR3Wdj.js";import{a as u}from"./apiClient-DATCuIGb.js";import{P as ie,B as Te,k as ze,g as Fe}from"./lucide-icons-D0L7Z31B.js";import{b as c,c as p,a as y,e as h,d as v,i as x,s as $e,l as Be,t as He,m as re,f as le,g as oe,h as ce,j as de}from"./nextui-vendor-BpFfdwSS.js";import"./vendor-BVwjo9X5.js";import"./utils-vendor-9uJw-9S8.js";import"./framer-motion-hFs7l1RU.js";const N=[{key:"zillow",label:"Zillow",channel:"ZILLOW",description:"Sync listings to Zillow and Zillow Rentals"},{key:"apartments",label:"Apartments.com",channel:"APARTMENTS_DOT_COM",description:"Sync listings to Apartments.com and ApartmentGuide"}],Ve=N.reduce((a,g)=>(a[g.channel]=g.key,a),{}),Ke=[{value:"AVAILABLE",label:"Available"},{value:"LIMITED",label:"Limited"},{value:"WAITLISTED",label:"Waitlisted"},{value:"COMING_SOON",label:"Coming Soon"},{value:"UNAVAILABLE",label:"Unavailable"}],me=()=>N.reduce((a,g)=>(a[g.key]={username:"",apiKey:"",isEnabled:!1},a),{}),Ze=a=>a!=null?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(a):"N/A",ue=a=>a?new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}):"n/a",Ge=a=>{switch(a){case"SUCCESS":return"success";case"FAILED":return"danger";case"IN_PROGRESS":return"warning";case"PAUSED":return"primary";default:return"default"}},xe=a=>[a?.address,a?.city,a?.state].filter(Boolean).join(", "),nt=()=>{const{token:a}=De(),[g,he]=n.useState([]),[S,M]=n.useState([]),[ge,L]=n.useState(!0),[I,o]=n.useState(null),[fe,k]=n.useState(!1),[pe,w]=n.useState(!1),[j,O]=n.useState(null),[T,z]=n.useState(!1),[l,f]=n.useState({minRent:"",maxRent:"",availabilityStatus:"AVAILABLE",marketingHeadline:"",marketingDescription:"",isSyndicationEnabled:!0}),[ye,F]=n.useState(!1),[$,B]=n.useState([]),[je,H]=n.useState(!1),[V,U]=n.useState(me()),[be,K]=n.useState(null),[ve,Z]=n.useState(!1),[Ne,G]=n.useState(!1),[m,b]=n.useState({name:"",address:"",city:"",state:""}),[W,q]=n.useState(!1),[Y,C]=n.useState(null),[_,J]=n.useState(""),[Q,X]=n.useState(!1),[ee,P]=n.useState(null),{selectedItem:r,showDetail:Se,selectItem:te,clearSelection:ke}=Re(),se=Oe(),E=n.useCallback(async()=>{if(!a){L(!1);return}L(!0),o(null);try{const t=await u("/properties",{token:a});he(t)}catch(t){console.error("fetchProperties",t),o("Unable to load properties right now.")}finally{L(!1)}},[a]),D=n.useCallback(async()=>{if(!(!a||!r)){z(!0),o(null);try{const t=await u(`/properties/${r.id}/marketing`,{token:a});O(t);const s=t.marketingProfile??{};f(i=>({...i,minRent:s.minRent!=null?String(Math.round(s.minRent)):"",maxRent:s.maxRent!=null?String(Math.round(s.maxRent)):"",availabilityStatus:s.availabilityStatus??i.availabilityStatus,marketingHeadline:s.marketingHeadline??"",marketingDescription:s.marketingDescription??"",isSyndicationEnabled:s.isSyndicationEnabled??i.isSyndicationEnabled}))}catch(t){console.error("fetchMarketingProfile",t),o("Unable to load marketing information.")}finally{z(!1)}}},[r,a]),A=n.useCallback(async()=>{if(!(!a||!r)){H(!0),o(null);try{const t=await u(`/listings/syndication/${r.id}/status`,{token:a});B(t)}catch(t){console.error("fetchSyndicationStatus",t),o("Unable to load syndication data.")}finally{H(!1)}}},[r,a]),R=n.useCallback(async()=>{if(a)try{const s=(await u("/listings/syndication/credentials/all",{token:a})).reduce((i,d)=>{const ne=Ve[d.channel];return ne&&(i[ne]={username:d.config?.username??d.config?.clientId??"",apiKey:d.config?.apiKey??d.config?.clientSecret??"",isEnabled:!!d.config?.active}),i},me());U(i=>({...i,...s}))}catch(t){console.error("fetchCredentials",t)}},[a]);n.useEffect(()=>{E()},[E]),n.useEffect(()=>{R()},[R]),n.useEffect(()=>{if(!r){M([]),O(null),B([]);return}M(r.units??[]),D(),A()},[r,D,A]);const we=async()=>{if(a){if(!m.name.trim()||!m.address.trim()){C("Property name and address are required.");return}q(!0),C(null);try{await u("/properties",{token:a,method:"POST",body:{name:m.name.trim(),address:m.address.trim(),city:m.city.trim()||void 0,state:m.state.trim()||void 0}}),await E(),k(!1),b({name:"",address:"",city:"",state:""})}catch(t){console.error("handleCreateProperty",t),C("Unable to create property right now.")}finally{q(!1)}}},Ce=async()=>{if(!(!a||!r)){if(!_.trim()){P("Unit name is required.");return}X(!0),P(null);try{const t=await u(`/properties/${r.id}/units`,{token:a,method:"POST",body:{name:_.trim()}}),s=[...S,t];M(s),te({...r,units:s}),await E(),J(""),w(!1)}catch(t){console.error("handleAddUnit",t),P("Unable to save the new unit.")}finally{X(!1)}}},Pe=async()=>{if(!(!a||!r)){F(!0),o(null);try{const t={minRent:l.minRent.trim()?Number(l.minRent):void 0,maxRent:l.maxRent.trim()?Number(l.maxRent):void 0,availabilityStatus:l.availabilityStatus,marketingHeadline:l.marketingHeadline.trim()||void 0,marketingDescription:l.marketingDescription.trim()||void 0,isSyndicationEnabled:l.isSyndicationEnabled};await u(`/properties/${r.id}/marketing`,{token:a,method:"POST",body:t}),await D()}catch(t){console.error("handleMarketingSave",t),o("Unable to save marketing updates at this time.")}finally{F(!1)}}},Ee=async()=>{if(!(!a||!r)){Z(!0),o(null);try{await u(`/listings/syndication/${r.id}/trigger`,{token:a,method:"POST",body:{}}),await A()}catch(t){console.error("handleTriggerSyndication",t),o("Unable to trigger syndication at the moment.")}finally{Z(!1)}}},Ae=async()=>{if(!(!a||!r)){G(!0),o(null);try{await u(`/listings/syndication/${r.id}/pause`,{token:a,method:"POST",body:{}}),await A()}catch(t){console.error("handlePauseSyndication",t),o("Unable to pause syndication at the moment.")}finally{G(!1)}}},ae=(t,s,i)=>{U(d=>({...d,[t]:{...d[t],[s]:i}}))},Me=t=>{U(s=>({...s,[t]:{...s[t],isEnabled:!s[t].isEnabled}}))},Le=async t=>{if(!a)return;const s=N.find(i=>i.key===t);if(s){K(t),o(null);try{const i=V[t],d={channel:s.channel,username:i.username||void 0,apiKey:i.apiKey||void 0,active:i.isEnabled};await u("/listings/syndication/credentials",{token:a,method:"POST",body:d}),await R()}catch(i){console.error("handleCredentialSave",i),o("Unable to save channel credential.")}finally{K(null)}}};if(ge)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("p",{className:"text-sm text-foreground-500",children:"Loading propertiesâ€¦"})});const Ue=e.jsxs("div",{className:"p-4 sm:p-6 h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Properties"}),e.jsx("p",{className:"text-sm text-foreground-500 mt-1",children:"Maintain listings, units, and marketing feeds."})]}),e.jsx(c,{color:"primary",startContent:e.jsx(ie,{size:18}),onClick:()=>k(!0),children:"Add Property"})]}),I&&e.jsx("p",{className:"text-sm text-danger-600",children:I}),e.jsx(p,{className:"flex-1 overflow-hidden",children:e.jsxs(y,{className:"space-y-4 overflow-y-auto max-h-[calc(100vh-220px)]",children:[g.length===0&&e.jsx("div",{className:"text-sm text-foreground-500",children:"No properties yet. Use the button above to add the first asset."}),g.map(t=>{const s=r?.id===t.id;return e.jsx(p,{isPressable:!0,className:`border ${s?"border-primary":"border-transparent"} transition`,onClick:()=>te(t),children:e.jsxs(y,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{size:20,className:"text-foreground-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:t.name}),e.jsxs("p",{className:"text-xs text-foreground-500",children:[e.jsx(ze,{size:12,className:"inline mr-1"}),xe(t)||"Address not set"]})]})]}),e.jsx(h,{color:t.marketingProfile?.availabilityStatus==="UNAVAILABLE"?"danger":"success",size:"sm",variant:"flat",children:t.marketingProfile?.availabilityStatus??"Unknown status"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-foreground-500",children:[e.jsxs("span",{children:[t.units?.length??t.unitCount??0," units"]}),e.jsx("span",{children:t.propertyType??"Property"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.tags?.slice(0,3).map(i=>e.jsx(h,{size:"sm",variant:"flat",children:i},`${t.id}-${i}`)),e.jsx(h,{color:t.marketingProfile?.isSyndicationEnabled?"success":"default",size:"sm",variant:"flat",children:t.marketingProfile?.isSyndicationEnabled?"Syndication enabled":"Syndication paused"})]})]})},t.id)})]})})]}),_e=e.jsx("div",{className:"p-4 sm:p-6 h-full flex flex-col gap-4",children:r?e.jsxs(e.Fragment,{children:[(se==="mobile"||se==="tablet-portrait")&&e.jsx(c,{isIconOnly:!0,variant:"light",onClick:ke,className:"w-12",children:e.jsx(Fe,{size:20})}),e.jsxs(p,{children:[e.jsxs(v,{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Property overview"}),e.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:r.name}),e.jsx("p",{className:"text-sm text-foreground-500",children:xe(r)||"Address not provided yet"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(h,{color:"primary",variant:"flat",children:r.marketingProfile?.availabilityStatus??"Unknown"}),e.jsxs(h,{color:"success",variant:"flat",children:[j?.unitCount??S.length," units"]})]})]}),e.jsxs(y,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Property type"}),e.jsx("p",{className:"text-sm text-foreground",children:r.propertyType??"Residential"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags?.map(t=>e.jsx(h,{size:"sm",variant:"flat",children:t},`tag-${t}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Last synced"}),e.jsx("p",{className:"text-sm text-foreground",children:j?.marketingProfile?.lastSyncedAt?ue(j.marketingProfile.lastSyncedAt):"Not synced yet"})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs(p,{className:"lg:col-span-2",children:[e.jsxs(v,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Units"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Manage units"})]}),e.jsx(c,{size:"sm",color:"primary",onClick:()=>w(!0),startContent:e.jsx(ie,{size:16}),children:"Add unit"})]}),e.jsxs(y,{className:"space-y-3 max-h-[420px] overflow-y-auto",children:[S.length===0&&e.jsx("p",{className:"text-sm text-foreground-500",children:"No units recorded yet."}),S.map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-dashed border-foreground/20 py-2 last:border-none",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:t.name}),e.jsx("p",{className:"text-xs text-foreground-500",children:t.status??"Status pending"})]}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.rent?Ze(t.rent):"Rent TBD"})]},t.id))]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(p,{children:[e.jsxs(v,{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Marketing"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Listing details"})]}),e.jsx(h,{color:"secondary",variant:"flat",children:j?.marketingProfile?.availabilityStatus??"Draft"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx(x,{label:"Min rent",type:"number",value:l.minRent,onChange:t=>f(s=>({...s,minRent:t.target.value})),placeholder:"0"}),e.jsx(x,{label:"Max rent",type:"number",value:l.maxRent,onChange:t=>f(s=>({...s,maxRent:t.target.value})),placeholder:"0"})]}),e.jsx($e,{label:"Availability",value:l.availabilityStatus,onChange:t=>f(s=>({...s,availabilityStatus:t.target.value})),children:Ke.map(t=>e.jsx(Be,{value:t.value,children:t.label},t.value))}),e.jsx(x,{label:"Marketing headline",value:l.marketingHeadline,onChange:t=>f(s=>({...s,marketingHeadline:t.target.value}))}),e.jsx(He,{label:"Marketing description",minRows:3,value:l.marketingDescription,onChange:t=>f(s=>({...s,marketingDescription:t.target.value}))}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("p",{className:"text-sm text-foreground-500",children:["Auto-syndication is ",l.isSyndicationEnabled?"Enabled":"Disabled"]}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>f(t=>({...t,isSyndicationEnabled:!t.isSyndicationEnabled})),children:l.isSyndicationEnabled?"Disable syndication":"Enable syndication"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Photos"}),e.jsxs("p",{className:"text-sm text-foreground",children:[j?.photos?.length??0," saved"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Amenities"}),e.jsxs("p",{className:"text-sm text-foreground",children:[j?.amenities?.length??0," mapped"]})]})]}),e.jsx(c,{color:"primary",onClick:Pe,isLoading:ye||T,disabled:T,children:"Save marketing updates"})]})]}),e.jsxs(p,{children:[e.jsxs(v,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Listing syndication"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Sync status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{size:"sm",color:"primary",onClick:Ee,isLoading:ve,children:"Sync now"}),e.jsx(c,{size:"sm",variant:"bordered",onClick:Ae,isLoading:Ne,children:"Pause"})]})]}),e.jsx(y,{className:"space-y-3",children:je?e.jsx("p",{className:"text-sm text-foreground-500",children:"Refreshing syndication state..."}):$.length===0?e.jsx("p",{className:"text-sm text-foreground-500",children:"No syndication history yet."}):$.map(t=>{const s=N.find(i=>i.channel===t.channel)?.label??t.channel;return e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-foreground/10 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s}),e.jsx("p",{className:"text-xs text-foreground-500",children:t.lastAttemptAt?ue(t.lastAttemptAt):"Awaiting first sync"}),t.lastError&&e.jsx("p",{className:"text-xs text-danger-600",children:t.lastError})]}),e.jsx(h,{size:"sm",color:Ge(t.status),variant:"flat",children:t.status.replace("_"," ")})]},t.id)})})]})]})]}),e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-foreground-500",children:"Channel credentials"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Listing syndication APIs"})]})}),e.jsx(y,{className:"space-y-6",children:N.map(t=>{const s=V[t.key];return e.jsxs("div",{className:"space-y-3 rounded-lg border border-foreground/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:t.label}),e.jsx("p",{className:"text-xs text-foreground-500",children:t.description})]}),e.jsx(h,{color:s.isEnabled?"success":"default",size:"sm",variant:"flat",children:s.isEnabled?"Enabled":"Disabled"})]}),e.jsx(x,{label:"Username or client ID",value:s.username,onChange:i=>ae(t.key,"username",i.target.value)}),e.jsx(x,{label:"API key or secret",type:"password",value:s.apiKey,onChange:i=>ae(t.key,"apiKey",i.target.value)}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>Me(t.key),children:s.isEnabled?"Turn off":"Enable"}),e.jsx(c,{size:"sm",color:"primary",onClick:()=>Le(t.key),isLoading:be===t.key,children:"Save credentials"})]})]},t.key)})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-sm text-foreground-500",children:"Select a property to view and manage its marketing."})})});return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{master:Ue,detail:_e,showDetail:Se}),e.jsx(re,{isOpen:fe,onClose:()=>{k(!1),C(null)},children:e.jsxs(le,{children:[e.jsx(oe,{children:"Add new property"}),e.jsxs(ce,{className:"space-y-4",children:[Y&&e.jsx("p",{className:"text-sm text-danger-600",children:Y}),e.jsx(x,{label:"Property name",value:m.name,onChange:t=>b(s=>({...s,name:t.target.value}))}),e.jsx(x,{label:"Address",value:m.address,onChange:t=>b(s=>({...s,address:t.target.value}))}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx(x,{label:"City",value:m.city,onChange:t=>b(s=>({...s,city:t.target.value}))}),e.jsx(x,{label:"State",value:m.state,onChange:t=>b(s=>({...s,state:t.target.value}))})]})]}),e.jsxs(de,{className:"flex justify-end gap-3",children:[e.jsx(c,{variant:"ghost",onClick:()=>k(!1),children:"Cancel"}),e.jsx(c,{color:"primary",onClick:we,isDisabled:W,isLoading:W,children:"Save property"})]})]})}),e.jsx(re,{isOpen:pe,onClose:()=>{w(!1),P(null)},children:e.jsxs(le,{children:[e.jsx(oe,{children:"Add unit"}),e.jsxs(ce,{className:"space-y-4",children:[ee&&e.jsx("p",{className:"text-sm text-danger-600",children:ee}),e.jsx(x,{label:"Unit name",value:_,onChange:t=>J(t.target.value)})]}),e.jsxs(de,{className:"flex justify-end gap-3",children:[e.jsx(c,{variant:"ghost",onClick:()=>w(!1),children:"Cancel"}),e.jsx(c,{color:"primary",onClick:Ce,isDisabled:Q,isLoading:Q,children:"Add unit"})]})]})})]})};export{nt as default};
