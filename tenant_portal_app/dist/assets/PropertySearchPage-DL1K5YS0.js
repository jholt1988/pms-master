import{r as m,j as a}from"./react-vendor-Cz9WDxg-.js";import{u as le}from"./index-BHiZdJVs.js";import{a as S,g as ne}from"./apiClient-DATCuIGb.js";import{d as oe,q as ce,r as U,s as de,t as me,k as he}from"./lucide-icons-D0L7Z31B.js";import{c as R,a as C,i as h,s as V,l as y,b as f,k as Y,e as x,d as pe,p as ue,n as xe}from"./nextui-vendor-BpFfdwSS.js";import"./vendor-BVwjo9X5.js";import"./utils-vendor-9uJw-9S8.js";import"./framer-motion-hFs7l1RU.js";const M=ne(),be=r=>{const t=new URLSearchParams,c=(o,d)=>{d&&d.length&&t.set(o,d.join(","))},i=(o,d)=>{typeof d=="number"&&!Number.isNaN(d)&&t.set(o,String(d))};return r.searchTerm&&t.set("searchTerm",r.searchTerm),c("cities",r.cities),c("states",r.states),c("propertyTypes",r.propertyTypes),c("availabilityStatuses",r.availabilityStatuses),c("amenityKeys",r.amenityKeys),c("tags",r.tags),i("minRent",r.minRent),i("maxRent",r.maxRent),i("bedroomsMin",r.bedroomsMin),i("bedroomsMax",r.bedroomsMax),i("bathroomsMin",r.bathroomsMin),i("bathroomsMax",r.bathroomsMax),r.page&&t.set("page",String(r.page)),r.pageSize&&t.set("pageSize",String(r.pageSize)),r.sortBy&&t.set("sortBy",r.sortBy),r.sortOrder&&t.set("sortOrder",r.sortOrder),t.toString()},ge=async(r,t)=>{const c=be(r),i=`${M}/search${c?`?${c}`:""}`;return S(i,{token:t})},ye=async r=>S(`${M}/saved-filters`,{token:r}),fe=async(r,t)=>S(`${M}/saved-filters`,{method:"POST",token:r,body:t}),ve=async(r,t)=>S(`${M}/saved-filters/${t}`,{method:"DELETE",token:r}),je=["Apartment","Condo","Townhome","Loft","Single Family"],Se=[{label:"Pool",value:"pool"},{label:"Fitness Center",value:"gym"},{label:"Parking",value:"parking"},{label:"Pet Friendly",value:"pet_friendly"},{label:"EV Charging",value:"ev_charging"}],Me=["AVAILABLE","LIMITED","WAITLISTED","COMING_SOON"],k={searchTerm:"",propertyTypes:[],availabilityStatuses:[],amenityKeys:[],minRent:"",maxRent:"",bedroomsMin:"",bedroomsMax:"",bathroomsMin:"",bathroomsMax:"",cityInput:"",stateInput:"",tagsInput:""},w=r=>r.split(",").map(t=>t.trim()).filter(t=>t.length>0),b=r=>{if(!r)return;const t=Number(r);return Number.isNaN(t)?void 0:t},H=(r,t)=>{if(r===void 0&&t===void 0)return"Pricing TBD";const c=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});return r!==void 0&&t!==void 0?`${c.format(r)} - ${c.format(t)}`:`${c.format(r??t??0)}`},Pe=()=>{const{token:r}=le(),[t,c]=m.useState(k),[i,o]=m.useState({page:1,pageSize:12,sortBy:"newest",sortOrder:"desc"}),[d,W]=m.useState(null),[q,I]=m.useState(!1),[P,$]=m.useState(null),[N,_]=m.useState([]),[g,A]=m.useState(""),[v,E]=m.useState(""),[B,O]=m.useState(""),[G,K]=m.useState(!1),[Q,D]=m.useState(!1),z=m.useCallback(async()=>{I(!0),$(null);try{const e=await ge(i,r||void 0);W(e)}catch(e){$(e instanceof Error?e.message:"Unable to load properties")}finally{I(!1)}},[i,r]);m.useEffect(()=>{z()},[z]);const j=m.useCallback(async()=>{if(!r){_([]);return}try{const e=await ye(r);_(e)}catch(e){console.error("Failed to load saved filters",e)}},[r]);m.useEffect(()=>{j()},[j]);const n=e=>{c(s=>({...s,...e}))},T=(e,s)=>{n({[e]:t[e].includes(s)?t[e].filter(p=>p!==s):[...t[e],s]})},F=()=>{const e={...i,searchTerm:t.searchTerm||void 0,propertyTypes:t.propertyTypes,availabilityStatuses:t.availabilityStatuses,amenityKeys:t.amenityKeys,cities:w(t.cityInput),states:w(t.stateInput),tags:w(t.tagsInput).map(s=>s.toLowerCase()),minRent:b(t.minRent),maxRent:b(t.maxRent),bedroomsMin:b(t.bedroomsMin),bedroomsMax:b(t.bedroomsMax),bathroomsMin:b(t.bathroomsMin),bathroomsMax:b(t.bathroomsMax),page:1};o(e)},X=()=>{c(k),o(e=>({sortBy:e.sortBy,sortOrder:e.sortOrder,page:1,pageSize:e.pageSize}))},J=(e,s)=>{const p=(u=[],l)=>u.filter(ie=>ie!==l);switch(e){case"search":n({searchTerm:""}),o(l=>({...l,searchTerm:void 0,page:1}));break;case"propertyType":n({propertyTypes:p(t.propertyTypes,s)}),o(l=>({...l,propertyTypes:p(l.propertyTypes,s),page:1}));break;case"availability":n({availabilityStatuses:p(t.availabilityStatuses,s)}),o(l=>({...l,availabilityStatuses:p(l.availabilityStatuses,s),page:1}));break;case"amenity":n({amenityKeys:p(t.amenityKeys,s)}),o(l=>({...l,amenityKeys:p(l.amenityKeys,s),page:1}));break;case"rent":n({minRent:"",maxRent:""}),o(l=>({...l,minRent:void 0,maxRent:void 0,page:1}));break;case"bedrooms":n({bedroomsMin:"",bedroomsMax:""}),o(l=>({...l,bedroomsMin:void 0,bedroomsMax:void 0,page:1}));break;case"bathrooms":n({bathroomsMin:"",bathroomsMax:""}),o(l=>({...l,bathroomsMin:void 0,bathroomsMax:void 0,page:1}));break;case"city":n({cityInput:""}),o(l=>({...l,cities:void 0,page:1}));break;case"state":n({stateInput:""}),o(l=>({...l,states:void 0,page:1}));break;case"tag":const u=(i.tags||[]).filter(l=>l!==s);n({tagsInput:u.join(", ")}),o(l=>({...l,tags:u,page:1}));break}},L=m.useMemo(()=>{const e=[];return i.searchTerm&&e.push({key:"search",label:`Search: ${i.searchTerm}`,type:"search"}),i.propertyTypes?.forEach(s=>e.push({key:`type-${s}`,label:`Type: ${s}`,type:"propertyType",value:s})),i.availabilityStatuses?.forEach(s=>e.push({key:`availability-${s}`,label:`Status: ${s}`,type:"availability",value:s})),i.amenityKeys?.forEach(s=>e.push({key:`amenity-${s}`,label:`Amenity: ${s}`,type:"amenity",value:s})),(i.minRent||i.maxRent)&&e.push({key:"rent",label:`Rent ${H(i.minRent,i.maxRent)}`,type:"rent"}),(i.bedroomsMin||i.bedroomsMax)&&e.push({key:"bedrooms",label:`Bedrooms ${i.bedroomsMin??"0"}-${i.bedroomsMax??"4+"}`,type:"bedrooms"}),(i.bathroomsMin||i.bathroomsMax)&&e.push({key:"bathrooms",label:`Baths ${i.bathroomsMin??"0"}-${i.bathroomsMax??"4+"}`,type:"bathrooms"}),i.cities?.length&&e.push({key:"city",label:`Cities: ${i.cities.join(", ")}`,type:"city"}),i.states?.length&&e.push({key:"state",label:`States: ${i.states.join(", ")}`,type:"state"}),i.tags?.forEach(s=>e.push({key:`tag-${s}`,label:`Tag: ${s}`,type:"tag",value:s})),e},[i]),Z=e=>{o(s=>({...s,sortBy:e,page:1}))},ee=e=>{o(s=>({...s,page:e}))},ae=e=>{A(e);const s=N.find(u=>u.id.toString()===e);if(!s)return;const p={...k,searchTerm:s.filters.searchTerm||"",propertyTypes:s.filters.propertyTypes||[],availabilityStatuses:s.filters.availabilityStatuses||[],amenityKeys:s.filters.amenityKeys||[],minRent:s.filters.minRent?String(s.filters.minRent):"",maxRent:s.filters.maxRent?String(s.filters.maxRent):"",bedroomsMin:s.filters.bedroomsMin?String(s.filters.bedroomsMin):"",bedroomsMax:s.filters.bedroomsMax?String(s.filters.bedroomsMax):"",bathroomsMin:s.filters.bathroomsMin?String(s.filters.bathroomsMin):"",bathroomsMax:s.filters.bathroomsMax?String(s.filters.bathroomsMax):"",cityInput:(s.filters.cities||[]).join(", "),stateInput:(s.filters.states||[]).join(", "),tagsInput:(s.filters.tags||[]).join(", ")};c(p),o(u=>({...u,...s.filters,sortBy:s.sortBy||u.sortBy,sortOrder:s.sortOrder||u.sortOrder,page:1}))},se=async()=>{if(!(!r||!v.trim())){K(!0);try{await fe(r,{name:v.trim(),description:B.trim()||void 0,filters:i}),E(""),O(""),await j()}catch(e){console.error("Failed to save filter",e)}finally{K(!1)}}},te=async()=>{if(!(!r||!g)){D(!0);try{await ve(r,Number(g)),A(""),await j()}catch(e){console.error("Failed to delete filter",e)}finally{D(!1)}}},re=()=>q?a.jsx("div",{className:"flex justify-center py-12",children:a.jsx(xe,{label:"Searching listings...",color:"primary"})}):P?a.jsx("div",{className:"text-center py-10 text-danger font-medium",children:P}):!d||d.items.length===0?a.jsx("div",{className:"text-center py-12 text-default-500",children:"No properties matched your filters. Try broadening your search."}):a.jsx("div",{className:"space-y-4",children:d.items.map(e=>a.jsx(R,{className:"border border-default-200",children:a.jsxs(C,{className:"grid gap-4 lg:grid-cols-[200px_1fr]",children:[a.jsx("div",{className:"rounded-lg bg-default-100 h-48 flex items-center justify-center overflow-hidden",children:e.photos?.length?a.jsx("img",{src:e.photos[0].url,alt:e.name,className:"w-full h-full object-cover"}):a.jsx("div",{className:"text-default-500 text-sm",children:"No photo"})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-lg font-semibold text-default-900",children:e.name}),a.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1",children:[a.jsx(he,{size:16}),e.address,e.city&&`, ${e.city}`,e.state&&`, ${e.state}`]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-xl font-bold text-primary",children:H(e.minRent,e.maxRent)}),a.jsx("p",{className:"text-xs text-default-500",children:"per month"})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.propertyType&&a.jsx(x,{variant:"flat",children:e.propertyType}),e.bedrooms&&a.jsxs(x,{variant:"flat",children:[e.bedrooms," beds"]}),e.bathrooms&&a.jsxs(x,{variant:"flat",children:[e.bathrooms," baths"]}),e.marketingProfile?.availabilityStatus&&a.jsx(x,{color:"success",variant:"flat",children:e.marketingProfile.availabilityStatus})]}),e.marketingProfile?.marketingHeadline&&a.jsx("p",{className:"text-sm text-default-600",children:e.marketingProfile.marketingHeadline}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[(e.tags||[]).slice(0,3).map(s=>a.jsxs(x,{size:"sm",variant:"bordered",children:["#",s]},s)),(e.amenities||[]).slice(0,3).map(s=>a.jsx(x,{size:"sm",variant:"light",children:s.amenity?.label||s.amenity?.key},`${e.id}-${s.id}`))]})]})]})},e.id))});return a.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[a.jsx(R,{children:a.jsxs(C,{className:"space-y-4",children:[a.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center",children:[a.jsx(h,{startContent:a.jsx(oe,{size:16}),label:"Search",placeholder:"Search by name, address or description",value:t.searchTerm,onChange:e=>n({searchTerm:e.target.value}),onKeyDown:e=>{e.key==="Enter"&&F()},className:"flex-1"}),a.jsxs(V,{label:"Sort by",selectedKeys:new Set([i.sortBy||"newest"]),onChange:e=>Z(e.target.value),children:[a.jsx(y,{value:"newest",children:"Newest"},"newest"),a.jsx(y,{value:"price",children:"Price"},"price"),a.jsx(y,{value:"bedrooms",children:"Bedrooms"},"bedrooms"),a.jsx(y,{value:"bathrooms",children:"Bathrooms"},"bathrooms")]}),a.jsx(f,{color:"primary",variant:"shadow",startContent:a.jsx(ce,{size:16}),onPress:F,children:"Apply search"})]}),a.jsx(Y,{}),a.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-end",children:[a.jsx(V,{label:"Saved filters",placeholder:"Select saved filter",selectedKeys:g?new Set([g]):void 0,onChange:e=>ae(e.target.value),className:"lg:w-1/3",disabled:!N.length,children:N.map(e=>a.jsx(y,{value:e.id.toString(),children:e.name},e.id.toString()))}),a.jsx(h,{label:"Filter name",placeholder:"Name to save current filters",value:v,onChange:e=>E(e.target.value),className:"flex-1"}),a.jsx(h,{label:"Filter description",placeholder:"Optional description",value:B,onChange:e=>O(e.target.value),className:"flex-1"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(f,{color:"secondary",variant:"flat",startContent:a.jsx(U,{size:16}),onPress:se,isDisabled:!r||!v.trim(),isLoading:G,children:"Save filter"}),a.jsx(f,{color:"danger",variant:"flat",startContent:a.jsx(de,{size:16}),onPress:te,isDisabled:!r||!g,isLoading:Q,children:"Delete"})]})]}),L.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(e=>a.jsx(x,{variant:"flat",onClose:()=>J(e.type,e.value),children:e.label},e.key))})]})}),a.jsxs("div",{className:"grid gap-4 lg:grid-cols-[320px_1fr]",children:[a.jsxs(R,{className:"h-fit",children:[a.jsxs(pe,{className:"flex items-center gap-2 text-base font-semibold",children:[a.jsx(U,{size:18})," Filters"]}),a.jsx(Y,{}),a.jsxs(C,{className:"space-y-4",children:[a.jsxs("section",{children:[a.jsx("p",{className:"text-sm font-semibold mb-2",children:"Property type"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:je.map(e=>a.jsx(x,{variant:t.propertyTypes.includes(e)?"solid":"bordered",color:t.propertyTypes.includes(e)?"primary":"default",onClick:()=>T("propertyTypes",e),className:"cursor-pointer","data-testid":`property-type-option-${e}`,children:e},e))})]}),a.jsxs("section",{children:[a.jsx("p",{className:"text-sm font-semibold mb-2",children:"Availability"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Me.map(e=>a.jsx(x,{variant:t.availabilityStatuses.includes(e)?"solid":"bordered",color:t.availabilityStatuses.includes(e)?"success":"default",onClick:()=>T("availabilityStatuses",e),className:"cursor-pointer",children:e},e))})]}),a.jsxs("section",{children:[a.jsx("p",{className:"text-sm font-semibold mb-2",children:"Amenities"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(e=>a.jsx(x,{variant:t.amenityKeys.includes(e.value)?"solid":"bordered",color:t.amenityKeys.includes(e.value)?"warning":"default",onClick:()=>T("amenityKeys",e.value),className:"cursor-pointer",startContent:a.jsx(me,{size:14}),children:e.label},e.value))})]}),a.jsxs("section",{className:"grid grid-cols-2 gap-3",children:[a.jsx(h,{label:"Min rent",placeholder:"e.g. 1200",value:t.minRent,onChange:e=>n({minRent:e.target.value})}),a.jsx(h,{label:"Max rent",placeholder:"e.g. 2800",value:t.maxRent,onChange:e=>n({maxRent:e.target.value})}),a.jsx(h,{label:"Min beds",placeholder:"2",value:t.bedroomsMin,onChange:e=>n({bedroomsMin:e.target.value})}),a.jsx(h,{label:"Max beds",placeholder:"4",value:t.bedroomsMax,onChange:e=>n({bedroomsMax:e.target.value})}),a.jsx(h,{label:"Min baths",placeholder:"1",value:t.bathroomsMin,onChange:e=>n({bathroomsMin:e.target.value})}),a.jsx(h,{label:"Max baths",placeholder:"3",value:t.bathroomsMax,onChange:e=>n({bathroomsMax:e.target.value})})]}),a.jsxs("section",{className:"grid gap-3",children:[a.jsx(h,{label:"Cities",placeholder:"Austin, Dallas",value:t.cityInput,onChange:e=>n({cityInput:e.target.value})}),a.jsx(h,{label:"States",placeholder:"TX, CA",value:t.stateInput,onChange:e=>n({stateInput:e.target.value})}),a.jsx(h,{label:"Tags",placeholder:"luxury, pet-friendly",value:t.tagsInput,onChange:e=>n({tagsInput:e.target.value})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(f,{fullWidth:!0,color:"primary",onPress:F,children:"Apply filters"}),a.jsx(f,{fullWidth:!0,variant:"bordered",onPress:X,children:"Reset"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[re(),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("p",{className:"text-sm text-default-500",children:d?`${d.total} properties found`:"Loading results..."}),a.jsx(ue,{total:Math.max(1,d?.totalPages||1),page:i.page||1,isDisabled:!d||d.totalPages===0,onChange:ee})]})]})]})]})};export{Pe as PropertySearchPage,Pe as default};
