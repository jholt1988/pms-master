import{r as o,j as e}from"./react-vendor-Cz9WDxg-.js";import{u as F}from"./index-BHiZdJVs.js";import{a as w}from"./apiClient-DATCuIGb.js";import"./vendor-BVwjo9X5.js";import"./nextui-vendor-BpFfdwSS.js";import"./framer-motion-hFs7l1RU.js";import"./utils-vendor-9uJw-9S8.js";import"./lucide-icons-D0L7Z31B.js";function P(){const{token:s}=F(),[f,v]=o.useState([]),[E,u]=o.useState(!0),[g,r]=o.useState(null),[C,m]=o.useState(!1),[i,D]=o.useState(""),[h,x]=o.useState(null),[l,p]=o.useState({category:"OTHER",description:""});o.useEffect(()=>{b()},[i]);const b=async()=>{if(!s){u(!1);return}u(!0),r(null);try{const t=new URLSearchParams;i&&t.append("category",i);const a=await w(`/documents?${t}`,{token:s});v(a.data||[])}catch(t){r(t.message||"Failed to load documents")}finally{u(!1)}},A=async t=>{if(t.preventDefault(),!s||!h){h||r("Please select a file");return}r(null);const a=new FormData;a.append("file",h),a.append("category",l.category),l.description&&a.append("description",l.description);try{const j=`${"http://localhost:3001/api".replace(/\/$/,"")}/documents/upload`,d=await fetch(j,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:a});if(!d.ok){const y=await d.json().catch(()=>({message:"Failed to upload document"}));throw new Error(y.message||"Failed to upload document")}m(!1),x(null),p({category:"OTHER",description:""}),b()}catch(n){r(n.message||"Failed to upload document")}},O=async(t,a)=>{if(s)try{const j=`${"http://localhost:3001/api".replace(/\/$/,"")}/documents/${t}/download`,d=await fetch(j,{headers:{Authorization:`Bearer ${s}`}});if(!d.ok)throw new Error("Failed to download document");const y=await d.blob(),N=window.URL.createObjectURL(y),c=document.createElement("a");c.href=N,c.download=a,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(N),document.body.removeChild(c)}catch(n){r(n.message||"Failed to download document")}},S=async t=>{if(s&&window.confirm("Are you sure you want to delete this document?"))try{await w(`/documents/${t}`,{token:s,method:"DELETE"}),b()}catch(a){r(a.message||"Failed to delete document")}};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Document Management"}),e.jsx("button",{onClick:()=>m(!0),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Upload Document"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("select",{value:i,onChange:t=>D(t.target.value),className:"border rounded px-4 py-2",children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"LEASE",children:"Lease"}),e.jsx("option",{value:"NOTICE",children:"Notice"}),e.jsx("option",{value:"INVOICE",children:"Invoice"}),e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"}),e.jsx("option",{value:"APPLICATION",children:"Application"}),e.jsx("option",{value:"OTHER",children:"Other"})]})}),g&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:g}),E?e.jsx("div",{children:"Loading..."}):e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"File Name"}),e.jsx("th",{className:"border px-4 py-2",children:"Category"}),e.jsx("th",{className:"border px-4 py-2",children:"Description"}),e.jsx("th",{className:"border px-4 py-2",children:"Uploaded By"}),e.jsx("th",{className:"border px-4 py-2",children:"Uploaded At"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"border px-4 py-2 text-center text-gray-500",children:"No documents found"})}):f.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:t.fileName}),e.jsx("td",{className:"border px-4 py-2",children:t.category}),e.jsx("td",{className:"border px-4 py-2",children:t.description||"-"}),e.jsx("td",{className:"border px-4 py-2",children:t.uploadedBy.username}),e.jsx("td",{className:"border px-4 py-2",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"border px-4 py-2",children:[e.jsx("button",{onClick:()=>O(t.id,t.fileName),className:"bg-blue-500 hover:bg-blue-700 text-white px-2 py-1 rounded mr-2",children:"Download"}),e.jsx("button",{onClick:()=>S(t.id),className:"bg-red-500 hover:bg-red-700 text-white px-2 py-1 rounded",children:"Delete"})]})]},t.id))})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Upload Document"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"File"}),e.jsx("input",{type:"file",onChange:t=>x(t.target.files?.[0]||null),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Category"}),e.jsxs("select",{value:l.category,onChange:t=>p({...l,category:t.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"LEASE",children:"Lease"}),e.jsx("option",{value:"NOTICE",children:"Notice"}),e.jsx("option",{value:"INVOICE",children:"Invoice"}),e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"}),e.jsx("option",{value:"APPLICATION",children:"Application"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:l.description,onChange:t=>p({...l,description:t.target.value}),className:"w-full border rounded px-3 py-2",rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded flex-1",children:"Upload"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),x(null),p({category:"OTHER",description:""})},className:"bg-gray-500 hover:bg-gray-700 text-white px-4 py-2 rounded flex-1",children:"Cancel"})]})]})]})})]})}export{P as default};
