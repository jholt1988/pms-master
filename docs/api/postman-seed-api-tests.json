{
  "info": {
    "name": "PropertyManagementSuite API Tests",
    "_postman_id": "57f6c9d1-3f9e-4a79-a553-4d3a1b8b9c4c",
    "description": "Smoke and regression tests for the tenant and property manager APIs. Update the `{{baseUrl}}` variable before running.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Authenticate Property Manager",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"admin_pm\",\n  \"password\": \"password123\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/auth/login",
          "host": ["{{baseUrl}}"],
          "path": ["api", "auth", "login"]
        },
        "description": "Use a seeded property manager account and store the returned token."
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Login returns 200', () => {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('Token is present', () => {",
              "  pm.expect(json.token).to.be.a('string');",
              "});",
              "",
              "if (json.token) {",
              "  pm.environment.set('authToken', json.token);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "List Properties",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{authToken}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/properties",
          "host": ["{{baseUrl}}"],
          "path": ["api", "properties"]
        },
        "description": "Ensure the property endpoint returns the seeded data."
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Properties endpoint accessible', () => {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('Properties array is not empty', () => {",
              "  pm.expect(json.data).to.be.an('array').that.is.not.empty;",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Fetch Lease Overview",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{authToken}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/leases",
          "host": ["{{baseUrl}}"],
          "path": ["api", "leases"]
        },
        "description": "Calls the lease listing to confirm leases seeded in the backend are available."
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Lease list responds', () => {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('At least one lease exists', () => {",
              "  pm.expect(json.data).to.be.an('array').that.is.not.empty;",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Tenant Inspections Summary",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{authToken}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/api/inspections",
          "host": ["{{baseUrl}}"],
          "path": ["api", "api", "inspections"]
        },
        "description": "Sanity-check the inspection endpoint seeded data."
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Inspections endpoint accessible', () => {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('Inspections data returns array', () => {",
              "  pm.expect(json.data).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "exec": [
          "if (!pm.environment.get('baseUrl')) {",
          "  pm.environment.set('baseUrl', 'http://localhost:3001');",
          "}",
          "",
          "pm.variables.set('authorization', pm.environment.get('authToken') ? `Bearer ${pm.environment.get('authToken')}` : '');"
        ],
        "type": "text/javascript"
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001"
    },
    {
      "key": "authToken",
      "value": ""
    }
  ]
}
